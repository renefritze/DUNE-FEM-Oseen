<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>dune-grid: mcmgmapper.hh Source File (dune-grid )</title>
  <link rel="stylesheet" type="text/css" href="./dune-doxy.css">
  <link rel="stylesheet" type="text/css" href="./tabs.css">
</head>
<div class="main">
<div class="doxygen">
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_5edca94048dae04696b7e65d07cd8e9c.html">grid</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_cbb40b532500855a4d3fb2d96695f9bb.html">common</a>
  </div>
</div>
<div class="contents">
<h1>mcmgmapper.hh</h1><a href="a00428.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id: mcmgmapper.hh 3903 2007-11-14 11:06:34Z sander $</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#ifndef DUNE_MCMGMAPPER_HH</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor">#define DUNE_MCMGMAPPER_HH</span>
<a name="l00005"></a>00005 <span class="preprocessor"></span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include "<a class="code" href="a00424.html" title="Provides classes with basic mappers which are used to attach data to a grid.">mapper.hh</a>"</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "<a class="code" href="a00440.html" title="Definition of reference elements for all types and dims.">referenceelements.hh</a>"</span>
<a name="l00010"></a>00010 
<a name="l00017"></a>00017 <span class="keyword">namespace </span>Dune
<a name="l00018"></a>00018 {
<a name="l00052"></a>00052   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> G, <span class="keyword">typename</span> IS, <span class="keyword">template</span>&lt;<span class="keywordtype">int</span>&gt; <span class="keyword">class </span>Layout&gt;
<a name="l00053"></a><a class="code" href="a00218.html">00053</a>   <span class="keyword">class </span><a class="code" href="a00218.html" title="Implementation class for a multiple codim and multiple geometry type mapper.">MultipleCodimMultipleGeomTypeMapper</a> : <a class="code" href="a00216.html" title="Mapper interface.">Mapper</a>&lt;G,MultipleCodimMultipleGeomTypeMapper&lt;G,IS,Layout&gt; &gt; {
<a name="l00054"></a>00054   <span class="keyword">public</span>:
<a name="l00055"></a>00055 
<a name="l00062"></a><a class="code" href="a00218.html#b4373d1a1f1e205a3e2e930ea06dcb53">00062</a>         <a class="code" href="a00218.html#b4373d1a1f1e205a3e2e930ea06dcb53" title="Construct mapper from grid and one of its index sets.">MultipleCodimMultipleGeomTypeMapper</a> (<span class="keyword">const</span> G&amp; grid, <span class="keyword">const</span> IS&amp; indexset)
<a name="l00063"></a>00063           : g(grid), is(indexset)
<a name="l00064"></a>00064         {
<a name="l00065"></a>00065           <a class="code" href="a00218.html#8e3945c0cac0ebfbc38c659acb09fd11" title="Recalculates map after mesh adaptation.">update</a>();
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067 
<a name="l00073"></a>00073         <span class="keyword">template</span>&lt;<span class="keyword">class</span> EntityType&gt;
<a name="l00074"></a><a class="code" href="a00218.html#b4a00de90b84dde25470d62b8c90bdb6">00074</a>         <span class="keywordtype">int</span> <a class="code" href="a00218.html#b4a00de90b84dde25470d62b8c90bdb6" title="Map entity to array index.">map</a> (<span class="keyword">const</span> EntityType&amp; e)<span class="keyword"> const</span>
<a name="l00075"></a>00075 <span class="keyword">        </span>{
<a name="l00076"></a>00076           <span class="keywordflow">return</span> is.index(e) + offset.find(e.type())-&gt;second;
<a name="l00077"></a>00077         }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079   
<a name="l00086"></a>00086         <span class="keyword">template</span>&lt;<span class="keywordtype">int</span> cc&gt;
<a name="l00087"></a><a class="code" href="a00218.html#3810fefb8f659972c66e969b223ec4a3">00087</a>         <span class="keywordtype">int</span> <a class="code" href="a00218.html#b4a00de90b84dde25470d62b8c90bdb6" title="Map entity to array index.">map</a> (<span class="keyword">const</span> <span class="keyword">typename</span> G::Traits::template Codim&lt;0&gt;::Entity&amp; e, <span class="keywordtype">int</span> i)<span class="keyword"> const</span>
<a name="l00088"></a>00088 <span class="keyword">        </span>{
<a name="l00089"></a>00089           GeometryType gt=ReferenceElements&lt;double,G::dimension&gt;::general(e.type()).type(i,cc);
<a name="l00090"></a>00090           <span class="comment">//      std::cout &lt;&lt; "map: cc=" &lt;&lt; cc &lt;&lt; " gt=" &lt;&lt; gt &lt;&lt; " offset=" &lt;&lt; offset.find(gt)-&gt;second &lt;&lt; std::endl;</span>
<a name="l00091"></a>00091           <span class="keywordflow">return</span> is.template subIndex&lt;cc&gt;(e,i) + offset.find(gt)-&gt;second;
<a name="l00092"></a>00092         }
<a name="l00093"></a>00093 
<a name="l00102"></a><a class="code" href="a00218.html#8557fb55457421a32474aa57fd09a378">00102</a>         <span class="keywordtype">int</span> <a class="code" href="a00218.html#8557fb55457421a32474aa57fd09a378" title="Return total number of entities in the entity set managed by the mapper.">size</a> ()<span class="keyword"> const</span>
<a name="l00103"></a>00103 <span class="keyword">        </span>{
<a name="l00104"></a>00104           <span class="keywordflow">return</span> n;
<a name="l00105"></a>00105         }
<a name="l00106"></a>00106  
<a name="l00113"></a>00113         <span class="keyword">template</span>&lt;<span class="keyword">class</span> EntityType&gt;
<a name="l00114"></a><a class="code" href="a00218.html#d65ad9a8492d3e8eb1246e0897a325ef">00114</a>         <span class="keywordtype">bool</span> <a class="code" href="a00218.html#d65ad9a8492d3e8eb1246e0897a325ef" title="Returns true if the entity is contained in the index set.">contains</a> (<span class="keyword">const</span> EntityType&amp; e, <span class="keywordtype">int</span>&amp; result)<span class="keyword"> const</span>
<a name="l00115"></a>00115 <span class="keyword">        </span>{
<a name="l00116"></a>00116           result = <a class="code" href="a00218.html#b4a00de90b84dde25470d62b8c90bdb6" title="Map entity to array index.">map</a>(e);
<a name="l00117"></a>00117           <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119 
<a name="l00127"></a>00127         <span class="keyword">template</span>&lt;<span class="keywordtype">int</span> cc&gt; <span class="comment">// this is now the subentity's codim</span>
<a name="l00128"></a><a class="code" href="a00218.html#aa27a3aadf1061e3fb809cb75ff6f7ed">00128</a>         <span class="keywordtype">bool</span> <a class="code" href="a00218.html#d65ad9a8492d3e8eb1246e0897a325ef" title="Returns true if the entity is contained in the index set.">contains</a> (<span class="keyword">const</span> <span class="keyword">typename</span> G::Traits::template Codim&lt;0&gt;::Entity&amp; e, <span class="keywordtype">int</span> i, <span class="keywordtype">int</span>&amp; result)<span class="keyword"> const</span>
<a name="l00129"></a>00129 <span class="keyword">        </span>{
<a name="l00130"></a>00130           result = this-&gt;<span class="keyword">template</span> map&lt;cc&gt;(e,i);
<a name="l00131"></a>00131           <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133  
<a name="l00134"></a>00134   
<a name="l00137"></a><a class="code" href="a00218.html#8e3945c0cac0ebfbc38c659acb09fd11">00137</a>         <span class="keywordtype">void</span> <a class="code" href="a00218.html#8e3945c0cac0ebfbc38c659acb09fd11" title="Recalculates map after mesh adaptation.">update</a> ()
<a name="l00138"></a>00138         {
<a name="l00139"></a>00139           <span class="comment">// get layout object;</span>
<a name="l00140"></a>00140           Layout&lt;G::dimension&gt; layout;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142           n=0; <span class="comment">// zero data elements</span>
<a name="l00143"></a>00143           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c=0; c&lt;=G::dimension; c++)
<a name="l00144"></a>00144                 offset.clear(); <span class="comment">// clear all maps</span>
<a name="l00145"></a>00145         
<a name="l00146"></a>00146           <span class="comment">// Compute offsets for the different geometry types.</span>
<a name="l00147"></a>00147           <span class="comment">// Note that mapper becomes invalid when the grid is modified.</span>
<a name="l00148"></a>00148           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> c=0; c&lt;=G::dimension; c++)
<a name="l00149"></a>00149                 <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i=0; i&lt;is.geomTypes(c).size(); i++)
<a name="l00150"></a>00150                   <span class="keywordflow">if</span> (layout.contains(is.geomTypes(c)[i]))
<a name="l00151"></a>00151                         {
<a name="l00152"></a>00152                           <span class="comment">//                      std::cout &lt;&lt; "offset " &lt;&lt; c &lt;&lt; " " &lt;&lt; is.geomTypes(c)[i] &lt;&lt; " is " &lt;&lt; n &lt;&lt; std::endl;</span>
<a name="l00153"></a>00153               offset[is.geomTypes(c)[i]] = n;
<a name="l00154"></a>00154               n += is.size(is.geomTypes(c)[i]);
<a name="l00155"></a>00155                         }
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157  
<a name="l00158"></a>00158   <span class="keyword">private</span>:
<a name="l00159"></a>00159         <span class="keywordtype">int</span> n; <span class="comment">// number of data elements required</span>
<a name="l00160"></a>00160         <span class="keyword">const</span> G&amp; g;
<a name="l00161"></a>00161         <span class="keyword">const</span> IS&amp; is;
<a name="l00162"></a>00162         std::map&lt;GeometryType,int&gt; offset; <span class="comment">// provide a map with all geometry types</span>
<a name="l00163"></a>00163   };
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 
<a name="l00189"></a>00189   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> G, <span class="keyword">template</span>&lt;<span class="keywordtype">int</span>&gt; <span class="keyword">class </span>Layout&gt;
<a name="l00190"></a><a class="code" href="a00195.html">00190</a>   <span class="keyword">class </span><a class="code" href="a00195.html" title="Multiple codim and multiple geometry type mapper for leaf entities.">LeafMultipleCodimMultipleGeomTypeMapper</a> 
<a name="l00191"></a>00191         : <span class="keyword">public</span> <a class="code" href="a00218.html" title="Implementation class for a multiple codim and multiple geometry type mapper.">MultipleCodimMultipleGeomTypeMapper</a>&lt;G,typename G::Traits::LeafIndexSet,Layout&gt; 
<a name="l00192"></a>00192   {
<a name="l00193"></a>00193   <span class="keyword">public</span>:
<a name="l00197"></a><a class="code" href="a00195.html#e5cb9d288ee41cfeaf4df39e1e2cfce4">00197</a>         <a class="code" href="a00195.html#e5cb9d288ee41cfeaf4df39e1e2cfce4" title="The constructor.">LeafMultipleCodimMultipleGeomTypeMapper</a> (<span class="keyword">const</span> G&amp; grid) 
<a name="l00198"></a>00198           : <a class="code" href="a00218.html" title="Implementation class for a multiple codim and multiple geometry type mapper.">MultipleCodimMultipleGeomTypeMapper</a>&lt;G,typename G::Traits::LeafIndexSet,Layout&gt;(grid,grid.leafIndexSet())
<a name="l00199"></a>00199         {}
<a name="l00200"></a>00200   };
<a name="l00201"></a>00201 
<a name="l00224"></a>00224   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> G, <span class="keyword">template</span>&lt;<span class="keywordtype">int</span>&gt; <span class="keyword">class </span>Layout&gt;
<a name="l00225"></a><a class="code" href="a00208.html">00225</a>   <span class="keyword">class </span><a class="code" href="a00208.html" title="Multiple codim and multiple geometry type mapper for entities of one level.">LevelMultipleCodimMultipleGeomTypeMapper</a> 
<a name="l00226"></a>00226         : <span class="keyword">public</span> <a class="code" href="a00218.html" title="Implementation class for a multiple codim and multiple geometry type mapper.">MultipleCodimMultipleGeomTypeMapper</a>&lt;G,typename G::Traits::LevelIndexSet,Layout&gt; {
<a name="l00227"></a>00227   <span class="keyword">public</span>:
<a name="l00232"></a><a class="code" href="a00208.html#650c6ce4131b63e77c8e39b32568e4fa">00232</a>         <a class="code" href="a00208.html#650c6ce4131b63e77c8e39b32568e4fa" title="The constructor.">LevelMultipleCodimMultipleGeomTypeMapper</a> (<span class="keyword">const</span> G&amp; grid, <span class="keywordtype">int</span> level) 
<a name="l00233"></a>00233           : <a class="code" href="a00218.html" title="Implementation class for a multiple codim and multiple geometry type mapper.">MultipleCodimMultipleGeomTypeMapper</a>&lt;G,typename G::Traits::LevelIndexSet,Layout&gt;(grid,grid.levelIndexSet(level))
<a name="l00234"></a>00234         {}
<a name="l00235"></a>00235   };
<a name="l00236"></a>00236 
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 <span class="preprocessor">#endif</span>
</pre></div></div>
</div> <!-- end doxygen -->
</div> <!-- end main -->
<div class="foot">

<p class="foot">
  Generated on 6 Nov 2008 with <a
  href="http://www.doxygen.org/">Doxygen</a> (ver 1.5.6)  
  [<a href="doxygen.log">logfile</a>].
</p>

</div>

</body>
</html>
