<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>dune-istl: bcrsmatrix.hh Source File (dune-istl )</title>
  <link rel="stylesheet" type="text/css" href="./dune-doxy.css">
  <link rel="stylesheet" type="text/css" href="./tabs.css">
</head>
<div class="main">
<div class="doxygen">
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_39c25fa0261c9359275e2f8975608afb.html">istl</a>
  </div>
</div>
<div class="contents">
<h1>bcrsmatrix.hh</h1><a href="a00138.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef DUNE_BCRSMATRIX_HH</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define DUNE_BCRSMATRIX_HH</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span>
<a name="l00004"></a>00004 <span class="preprocessor">#include&lt;cmath&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include&lt;complex&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include&lt;set&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include&lt;iostream&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include&lt;algorithm&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include&lt;numeric&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include&lt;vector&gt;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include "istlexception.hh"</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include "allocator.hh"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="a00140.html" title="This file implements a vector space as a tensor product of a given vector space....">bvector.hh</a>"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;dune/common/stdstreams.hh&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;dune/common/iteratorfacades.hh&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;dune/common/typetraits.hh&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;dune/common/helpertemplates.hh&gt;</span>
<a name="l00019"></a>00019 
<a name="l00024"></a>00024 <span class="keyword">namespace </span>Dune {
<a name="l00025"></a>00025   
<a name="l00144"></a>00144 <span class="preprocessor">#ifdef DUNE_EXPRESSIONTEMPLATES</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>  <span class="keyword">template</span>&lt;<span class="keyword">class</span> B, <span class="keyword">class</span> A&gt;
<a name="l00146"></a>00146   <span class="keyword">class </span>BCRSMatrix : <span class="keyword">public</span> ExprTmpl::Matrix&lt; BCRSMatrix&lt;B,A&gt; &gt;
<a name="l00147"></a>00147 #else
<a name="l00148"></a>00148   template&lt;class B, class A=ISTLAllocator&gt;
<a name="l00149"></a><a class="code" href="a00014.html">00149</a>   class <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>
<a name="l00150"></a>00150 #endif
<a name="l00151"></a>00151   {
<a name="l00152"></a>00152   <span class="keyword">private</span>:
<a name="l00153"></a>00153     <span class="keyword">enum</span> BuildStage{
<a name="l00155"></a>00155       notbuilt=0, 
<a name="l00160"></a>00160       rowSizesBuilt=1, 
<a name="l00162"></a>00162       built=2
<a name="l00163"></a>00163     };
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   <span class="keyword">public</span>:
<a name="l00166"></a>00166 
<a name="l00167"></a>00167         <span class="comment">//===== type definitions and constants</span>
<a name="l00168"></a>00168 
<a name="l00170"></a><a class="code" href="a00014.html#23ec4670373dbb79112f8a7f3ba7a785">00170</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> B::field_type <a class="code" href="a00014.html#23ec4670373dbb79112f8a7f3ba7a785" title="export the type representing the field">field_type</a>;
<a name="l00171"></a>00171 
<a name="l00173"></a><a class="code" href="a00014.html#c27f92bda3724989a12c908d5b0bb355">00173</a>         <span class="keyword">typedef</span> B <a class="code" href="a00014.html#c27f92bda3724989a12c908d5b0bb355" title="export the type representing the components">block_type</a>;
<a name="l00174"></a>00174 
<a name="l00176"></a><a class="code" href="a00014.html#fbabf44198dc84c120bd577ef6166d09">00176</a>         <span class="keyword">typedef</span> A <a class="code" href="a00014.html#fbabf44198dc84c120bd577ef6166d09" title="export the allocator type">allocator_type</a>;
<a name="l00177"></a>00177 
<a name="l00179"></a><a class="code" href="a00014.html#ab135eaab39502cd94ca8edb272c5ab3">00179</a>         <span class="keyword">typedef</span> <a class="code" href="a00036.html">CompressedBlockVectorWindow&lt;B,A&gt;</a> <a class="code" href="a00036.html">row_type</a>;
<a name="l00180"></a>00180         
<a name="l00182"></a><a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b">00182</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> A::size_type <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a>;
<a name="l00183"></a>00183     
<a name="l00185"></a>00185         <span class="keyword">enum</span> {
<a name="l00187"></a><a class="code" href="a00014.html#dc077235e483447874d479ffbe68af0fabfb0faddb4b8213f31e20aef7559379">00187</a>           <a class="code" href="a00014.html#dc077235e483447874d479ffbe68af0fabfb0faddb4b8213f31e20aef7559379" title="The number of blocklevels the matrix contains.">blocklevel</a> = B::blocklevel+1
<a name="l00188"></a>00188         };
<a name="l00189"></a>00189 
<a name="l00191"></a><a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ec">00191</a>         <span class="keyword">enum</span> <a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ec" title="we support two modes">BuildMode</a> {
<a name="l00202"></a><a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecf7c450c73d8588d16cf4c65552b0ff18">00202</a>           <a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecf7c450c73d8588d16cf4c65552b0ff18" title="Build in a row-wise manner.">row_wise</a>, 
<a name="l00211"></a><a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecd05f70b8e286d23abee639a8d50552e3">00211</a>           <a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecd05f70b8e286d23abee639a8d50552e3" title="Build entries randomly.">random</a>,
<a name="l00215"></a><a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ec92b68407d7d0300588b1279b91838917">00215</a>           <a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ec92b68407d7d0300588b1279b91838917" title="Build mode not set!">unknown</a>
<a name="l00216"></a>00216         };
<a name="l00217"></a>00217         
<a name="l00218"></a>00218 
<a name="l00219"></a>00219         <span class="comment">//===== random access interface to rows of the matrix</span>
<a name="l00220"></a>00220 
<a name="l00222"></a><a class="code" href="a00014.html#9a455ff0bc014b25b29a7aca924ee5b8">00222</a>         <a class="code" href="a00036.html">row_type</a>&amp; <a class="code" href="a00014.html#9a455ff0bc014b25b29a7aca924ee5b8" title="random access to the rows">operator[] </a>(<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i)
<a name="l00223"></a>00223         {
<a name="l00224"></a>00224 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l00225"></a>00225 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (r==0) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"row not initialized yet"</span>);
<a name="l00226"></a>00226           <span class="keywordflow">if</span> (i&gt;=n) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00227"></a>00227           <span class="keywordflow">if</span> (r[i].getptr()==0) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"row not initialized yet"</span>);
<a name="l00228"></a>00228 <span class="preprocessor">#endif</span>
<a name="l00229"></a>00229 <span class="preprocessor"></span>          <span class="keywordflow">return</span> r[i];
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231 
<a name="l00233"></a><a class="code" href="a00014.html#987274037faefb9c5335f0b27218c34f">00233</a>         <span class="keyword">const</span> <a class="code" href="a00036.html">row_type</a>&amp; <a class="code" href="a00014.html#9a455ff0bc014b25b29a7aca924ee5b8" title="random access to the rows">operator[] </a>(<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i)<span class="keyword"> const</span>
<a name="l00234"></a>00234 <span class="keyword">        </span>{
<a name="l00235"></a>00235 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (built!=ready) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"row not initialized yet"</span>);
<a name="l00237"></a>00237           <span class="keywordflow">if</span> (i&gt;=n) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00238"></a>00238 <span class="preprocessor">#endif</span>
<a name="l00239"></a>00239 <span class="preprocessor"></span>          <span class="keywordflow">return</span> r[i];
<a name="l00240"></a>00240         }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 
<a name="l00243"></a>00243         <span class="comment">//===== iterator interface to rows of the matrix</span>
<a name="l00244"></a>00244 
<a name="l00246"></a>00246     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;
<a name="l00247"></a><a class="code" href="a00016.html">00247</a>     <span class="keyword">class </span><a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator</a>
<a name="l00248"></a>00248       : <span class="keyword">public</span> RandomAccessIteratorFacade&lt;RealRowIterator&lt;T&gt;, T&gt;
<a name="l00249"></a>00249     {
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     <span class="keyword">public</span>:
<a name="l00253"></a><a class="code" href="a00016.html#d89a3bc19e916dcf4b0dc5ab68c71596">00253</a>       <span class="keyword">typedef</span> <span class="keyword">typename</span> remove_const&lt;T&gt;::type <a class="code" href="a00016.html#d89a3bc19e916dcf4b0dc5ab68c71596" title="The unqualified value type.">ValueType</a>;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255       <span class="keyword">friend</span> <span class="keyword">class </span>RandomAccessIteratorFacade&lt;<a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator</a>&lt;const <a class="code" href="a00016.html#d89a3bc19e916dcf4b0dc5ab68c71596" title="The unqualified value type.">ValueType</a>&gt;, const <a class="code" href="a00016.html#d89a3bc19e916dcf4b0dc5ab68c71596" title="The unqualified value type.">ValueType</a>&gt;;
<a name="l00256"></a>00256       <span class="keyword">friend</span> <span class="keyword">class </span>RandomAccessIteratorFacade&lt;<a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator</a>&lt;<a class="code" href="a00016.html#d89a3bc19e916dcf4b0dc5ab68c71596" title="The unqualified value type.">ValueType</a>&gt;, <a class="code" href="a00016.html#d89a3bc19e916dcf4b0dc5ab68c71596" title="The unqualified value type.">ValueType</a>&gt;;
<a name="l00257"></a>00257       <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator</a>&lt;const <a class="code" href="a00016.html#d89a3bc19e916dcf4b0dc5ab68c71596" title="The unqualified value type.">ValueType</a>&gt;;
<a name="l00258"></a>00258       <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator</a>&lt;<a class="code" href="a00016.html#d89a3bc19e916dcf4b0dc5ab68c71596" title="The unqualified value type.">ValueType</a>&gt;;
<a name="l00259"></a>00259       
<a name="l00261"></a><a class="code" href="a00016.html#9fed5aa653a0991aea448c0bcb19dbec">00261</a>       <a class="code" href="a00016.html#04496f31228fb455c14cb78feb32c00f" title="empty constructor, use with care!">RealRowIterator</a> (<a class="code" href="a00036.html">row_type</a>* _p, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> _i)
<a name="l00262"></a>00262         : p(_p), i(_i)
<a name="l00263"></a>00263       {}
<a name="l00264"></a>00264 
<a name="l00266"></a><a class="code" href="a00016.html#04496f31228fb455c14cb78feb32c00f">00266</a>       <a class="code" href="a00016.html#04496f31228fb455c14cb78feb32c00f" title="empty constructor, use with care!">RealRowIterator</a> ()
<a name="l00267"></a>00267         : p(0), i(0)
<a name="l00268"></a>00268       {}
<a name="l00269"></a>00269       
<a name="l00270"></a>00270       <a class="code" href="a00016.html#04496f31228fb455c14cb78feb32c00f" title="empty constructor, use with care!">RealRowIterator</a>(<span class="keyword">const</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator&lt;ValueType&gt;</a>&amp; it)
<a name="l00271"></a>00271         : p(it.p), i(it.i)
<a name="l00272"></a>00272       {}
<a name="l00273"></a>00273 
<a name="l00274"></a>00274       
<a name="l00276"></a><a class="code" href="a00016.html#f901cd7cfcfc61ee1645c4c984dd4284">00276</a>       <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> <a class="code" href="a00016.html#f901cd7cfcfc61ee1645c4c984dd4284" title="return index">index</a> ()<span class="keyword"> const</span>
<a name="l00277"></a>00277 <span class="keyword">      </span>{
<a name="l00278"></a>00278         <span class="keywordflow">return</span> i;
<a name="l00279"></a>00279       }
<a name="l00280"></a>00280       
<a name="l00281"></a>00281       std::ptrdiff_t distanceTo(<span class="keyword">const</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator&lt;ValueType&gt;</a>&amp; other)<span class="keyword"> const</span>
<a name="l00282"></a>00282 <span class="keyword">      </span>{
<a name="l00283"></a>00283         assert(other.<a class="code" href="a00016.html#51110a9808d48e2657ca1e125ea4ae3b">p</a>==p);
<a name="l00284"></a>00284         <span class="keywordflow">return</span> (other.<a class="code" href="a00016.html#6ea6a5789a1b8d75ad12d4a6e50efca6">i</a>-i);
<a name="l00285"></a>00285       }
<a name="l00286"></a>00286       
<a name="l00287"></a>00287       std::ptrdiff_t distanceTo(<span class="keyword">const</span> RealRowIterator&lt;const ValueType&gt;&amp; other)<span class="keyword"> const</span>
<a name="l00288"></a>00288 <span class="keyword">      </span>{
<a name="l00289"></a>00289         assert(other.p==p);
<a name="l00290"></a>00290         <span class="keywordflow">return</span> (other.i-i);
<a name="l00291"></a>00291       }
<a name="l00292"></a>00292       
<a name="l00294"></a><a class="code" href="a00016.html#172565b7b4ddaf952aed4d69ff79c7b6">00294</a>       <span class="keywordtype">bool</span> <a class="code" href="a00016.html#172565b7b4ddaf952aed4d69ff79c7b6" title="equality">equals</a> (<span class="keyword">const</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator&lt;ValueType&gt;</a>&amp; other)<span class="keyword"> const</span>
<a name="l00295"></a>00295 <span class="keyword">      </span>{
<a name="l00296"></a>00296         assert(other.<a class="code" href="a00016.html#51110a9808d48e2657ca1e125ea4ae3b">p</a>==p);
<a name="l00297"></a>00297         <span class="keywordflow">return</span> i==other.<a class="code" href="a00016.html#6ea6a5789a1b8d75ad12d4a6e50efca6">i</a>;
<a name="l00298"></a>00298       }
<a name="l00299"></a>00299       
<a name="l00301"></a><a class="code" href="a00016.html#69c383891893385a79af791acd526ea3">00301</a>       <span class="keywordtype">bool</span> <a class="code" href="a00016.html#172565b7b4ddaf952aed4d69ff79c7b6" title="equality">equals</a> (<span class="keyword">const</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator&lt;const ValueType&gt;</a>&amp; other)<span class="keyword"> const</span>
<a name="l00302"></a>00302 <span class="keyword">      </span>{
<a name="l00303"></a>00303         assert(other.<a class="code" href="a00016.html#51110a9808d48e2657ca1e125ea4ae3b">p</a>==p);
<a name="l00304"></a>00304         <span class="keywordflow">return</span> i==other.<a class="code" href="a00016.html#6ea6a5789a1b8d75ad12d4a6e50efca6">i</a>;
<a name="l00305"></a>00305       }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307     <span class="keyword">private</span>:
<a name="l00309"></a>00309       <span class="keywordtype">void</span> increment()
<a name="l00310"></a>00310       {
<a name="l00311"></a>00311         ++i;
<a name="l00312"></a>00312       }
<a name="l00313"></a>00313       
<a name="l00315"></a>00315       <span class="keywordtype">void</span> decrement()
<a name="l00316"></a>00316       {
<a name="l00317"></a>00317         --i;
<a name="l00318"></a>00318       }
<a name="l00319"></a>00319           
<a name="l00320"></a>00320       <span class="keywordtype">void</span> advance(std::ptrdiff_t diff)
<a name="l00321"></a>00321       {
<a name="l00322"></a>00322         i+=diff;
<a name="l00323"></a>00323       }
<a name="l00324"></a>00324       
<a name="l00325"></a>00325       T&amp; elementAt(std::ptrdiff_t diff)<span class="keyword"> const</span>
<a name="l00326"></a>00326 <span class="keyword">      </span>{
<a name="l00327"></a>00327         <span class="keywordflow">return</span> p[i+diff];
<a name="l00328"></a>00328       }
<a name="l00329"></a>00329 
<a name="l00331"></a>00331       <a class="code" href="a00014.html#ab135eaab39502cd94ca8edb272c5ab3" title="implement row_type with compressed vector">row_type</a>&amp; dereference ()<span class="keyword"> const</span>
<a name="l00332"></a>00332 <span class="keyword">      </span>{
<a name="l00333"></a>00333         <span class="keywordflow">return</span> p[i];
<a name="l00334"></a>00334       }
<a name="l00335"></a>00335       
<a name="l00336"></a>00336       <a class="code" href="a00014.html#ab135eaab39502cd94ca8edb272c5ab3" title="implement row_type with compressed vector">row_type</a>* p;
<a name="l00337"></a>00337       <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i;
<a name="l00338"></a>00338     };
<a name="l00339"></a>00339 
<a name="l00341"></a><a class="code" href="a00014.html#6426ed2b23a28e0b942ceb88cad77259">00341</a>     <span class="keyword">typedef</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator&lt;row_type&gt;</a> <a class="code" href="a00016.html" title="Iterator access to matrix rows">iterator</a>;
<a name="l00342"></a>00342     <span class="keyword">typedef</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator&lt;row_type&gt;</a> <a class="code" href="a00016.html" title="Iterator access to matrix rows">Iterator</a>;
<a name="l00343"></a>00343     
<a name="l00344"></a>00344 
<a name="l00346"></a><a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413">00346</a>         <a class="code" href="a00016.html" title="Iterator access to matrix rows">Iterator</a> <a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a> ()
<a name="l00347"></a>00347         {
<a name="l00348"></a>00348           <span class="keywordflow">return</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">Iterator</a>(r,0);
<a name="l00349"></a>00349         }
<a name="l00350"></a>00350           
<a name="l00352"></a><a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049">00352</a>         <a class="code" href="a00016.html" title="Iterator access to matrix rows">Iterator</a> <a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a> ()
<a name="l00353"></a>00353         {
<a name="l00354"></a>00354           <span class="keywordflow">return</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">Iterator</a>(r,n);
<a name="l00355"></a>00355         }
<a name="l00356"></a>00356 
<a name="l00358"></a><a class="code" href="a00014.html#c7f16e21a066337908486384ee1fb295">00358</a>         <a class="code" href="a00016.html" title="Iterator access to matrix rows">Iterator</a> <a class="code" href="a00014.html#c7f16e21a066337908486384ee1fb295" title="Get iterator to last row.">rbegin</a> ()
<a name="l00359"></a>00359         {
<a name="l00360"></a>00360           <span class="keywordflow">return</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">Iterator</a>(r,n-1);
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362           
<a name="l00364"></a><a class="code" href="a00014.html#c801ceb9c7b4757b247a30abd333e8f6">00364</a>         <a class="code" href="a00016.html" title="Iterator access to matrix rows">Iterator</a> <a class="code" href="a00014.html#c801ceb9c7b4757b247a30abd333e8f6" title="Get iterator to one before first row.">rend</a> ()
<a name="l00365"></a>00365         {
<a name="l00366"></a>00366           <span class="keywordflow">return</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">Iterator</a>(r,-1);
<a name="l00367"></a>00367         }
<a name="l00368"></a>00368 
<a name="l00370"></a><a class="code" href="a00014.html#2efdf9ce2539b8aead490775ba26dac0">00370</a>         <span class="keyword">typedef</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">Iterator</a> <a class="code" href="a00016.html" title="Iterator access to matrix rows">RowIterator</a>;
<a name="l00371"></a>00371 
<a name="l00373"></a><a class="code" href="a00014.html#8a2230f988557dfbbc5a2bb7d688fd35">00373</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="a00034.html" title="iterator class for sequential access">row_type::Iterator</a> <a class="code" href="a00034.html" title="iterator class for sequential access">ColIterator</a>;
<a name="l00374"></a>00374 
<a name="l00376"></a><a class="code" href="a00014.html#1cec23735a4b8543c573e7b7e01a9bd5">00376</a>     <span class="keyword">typedef</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator&lt;const row_type&gt;</a> <a class="code" href="a00016.html" title="Iterator access to matrix rows">const_iterator</a>;
<a name="l00377"></a>00377     <span class="keyword">typedef</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">RealRowIterator&lt;const row_type&gt;</a> <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstIterator</a>;
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 
<a name="l00381"></a><a class="code" href="a00014.html#408431cd334d92b0a4f480ed61d872cd">00381</a>         <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstIterator</a> <a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a> ()<span class="keyword"> const</span>
<a name="l00382"></a>00382 <span class="keyword">        </span>{
<a name="l00383"></a>00383           <span class="keywordflow">return</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstIterator</a>(r,0);
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385           
<a name="l00387"></a><a class="code" href="a00014.html#1f53a72b786a1bd3e08a1b10190a49c8">00387</a>         <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstIterator</a> <a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a> ()<span class="keyword"> const</span>
<a name="l00388"></a>00388 <span class="keyword">        </span>{
<a name="l00389"></a>00389           <span class="keywordflow">return</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstIterator</a>(r,n);
<a name="l00390"></a>00390         }
<a name="l00391"></a>00391 
<a name="l00393"></a><a class="code" href="a00014.html#38cb7b37f0c54f404342aa5dd2bd7bb2">00393</a>         <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstIterator</a> <a class="code" href="a00014.html#c7f16e21a066337908486384ee1fb295" title="Get iterator to last row.">rbegin</a> ()<span class="keyword"> const</span>
<a name="l00394"></a>00394 <span class="keyword">        </span>{
<a name="l00395"></a>00395           <span class="keywordflow">return</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstIterator</a>(r,n-1);
<a name="l00396"></a>00396         }
<a name="l00397"></a>00397           
<a name="l00399"></a><a class="code" href="a00014.html#b6d3b1cc939340489a337d94eaebf4fd">00399</a>         <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstIterator</a> <a class="code" href="a00014.html#c801ceb9c7b4757b247a30abd333e8f6" title="Get iterator to one before first row.">rend</a> ()<span class="keyword"> const</span>
<a name="l00400"></a>00400 <span class="keyword">        </span>{
<a name="l00401"></a>00401           <span class="keywordflow">return</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstIterator</a>(r,-1);
<a name="l00402"></a>00402         }
<a name="l00403"></a>00403 
<a name="l00405"></a><a class="code" href="a00014.html#55aab1eeee5f07e1a1a19318cf196c7c">00405</a>         <span class="keyword">typedef</span> <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstIterator</a> <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a>;
<a name="l00406"></a>00406 
<a name="l00408"></a><a class="code" href="a00014.html#a76d2016ee31d3781ec5d48925251d3b">00408</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="a00034.html" title="iterator class for sequential access">row_type::ConstIterator</a> <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a>;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410         <span class="comment">//===== constructors &amp; resizers</span>
<a name="l00411"></a>00411 
<a name="l00413"></a><a class="code" href="a00014.html#34b65fb52b4b7da95999604d8fabba92">00413</a>         <a class="code" href="a00014.html#34b65fb52b4b7da95999604d8fabba92" title="an empty matrix">BCRSMatrix</a> () 
<a name="l00414"></a>00414           : build_mode(<a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ec92b68407d7d0300588b1279b91838917" title="Build mode not set!">unknown</a>), ready(notbuilt), n(0), m(0), nnz(0),
<a name="l00415"></a>00415             r(0), a(0), j(0)
<a name="l00416"></a>00416         {}
<a name="l00417"></a>00417 
<a name="l00419"></a><a class="code" href="a00014.html#76bc4d8de5595e723c623f2fc6bb3122">00419</a>         <a class="code" href="a00014.html#34b65fb52b4b7da95999604d8fabba92" title="an empty matrix">BCRSMatrix</a> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> _n, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> _m, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> _nnz, <a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ec" title="we support two modes">BuildMode</a> bm)
<a name="l00420"></a>00420           : build_mode(bm), ready(notbuilt)
<a name="l00421"></a>00421         {
<a name="l00422"></a>00422           allocate(_n, _m, _nnz);
<a name="l00423"></a>00423         }
<a name="l00424"></a>00424 
<a name="l00426"></a><a class="code" href="a00014.html#cdbe4d1f81bc548f3be507d6e9a45bff">00426</a>         <a class="code" href="a00014.html#34b65fb52b4b7da95999604d8fabba92" title="an empty matrix">BCRSMatrix</a> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> _n, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> _m, <a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ec" title="we support two modes">BuildMode</a> bm)
<a name="l00427"></a>00427           : build_mode(bm), ready(notbuilt)
<a name="l00428"></a>00428         {
<a name="l00429"></a>00429           allocate(_n, _m);
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431 
<a name="l00433"></a><a class="code" href="a00014.html#79a0f0d9b34cada933c1c919cd67416b">00433</a>         <a class="code" href="a00014.html#34b65fb52b4b7da95999604d8fabba92" title="an empty matrix">BCRSMatrix</a> (<span class="keyword">const</span> <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; Mat)
<a name="l00434"></a>00434           : n(Mat.n), nnz(0)
<a name="l00435"></a>00435         {
<a name="l00436"></a>00436           <span class="comment">// deep copy in global array</span>
<a name="l00437"></a>00437           <span class="keywordtype">int</span> _nnz = Mat.<a class="code" href="a00014.html#1ff68b436b8f0a78b9318e9068a32274">nnz</a>;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439           <span class="comment">// in case of row-wise allocation</span>
<a name="l00440"></a>00440           <span class="keywordflow">if</span> (_nnz&lt;=0)
<a name="l00441"></a>00441                 {
<a name="l00442"></a>00442                   _nnz = 0;
<a name="l00443"></a>00443                   <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i=0; i&lt;n; i++)
<a name="l00444"></a>00444                         _nnz += Mat.<a class="code" href="a00014.html#811ac6c78bf57efe0f8e6204b486aba6">r</a>[i].<a class="code" href="a00036.html#da993a1e41ffc1452a45e002b9c773a9" title="get size">getsize</a>();
<a name="l00445"></a>00445                 }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447           allocate(Mat.<a class="code" href="a00014.html#b647dfcec2e9b6d7eb859e323d6fed66">n</a>, Mat.<a class="code" href="a00014.html#1a629cfcdbb749dba27ad6bb972e033f">m</a>, _nnz);
<a name="l00448"></a>00448 
<a name="l00449"></a>00449           <span class="comment">// build window structure</span>
<a name="l00450"></a>00450           copyWindowStructure(Mat);
<a name="l00451"></a>00451         }
<a name="l00452"></a>00452 
<a name="l00454"></a><a class="code" href="a00014.html#2afb5571f80472c948bd0db3b7440f8f">00454</a>         <a class="code" href="a00014.html#2afb5571f80472c948bd0db3b7440f8f" title="destructor">~BCRSMatrix</a> ()
<a name="l00455"></a>00455         {
<a name="l00456"></a>00456           deallocate();
<a name="l00457"></a>00457         }
<a name="l00458"></a>00458 
<a name="l00463"></a><a class="code" href="a00014.html#e747343dfc94f181f31471ceed7e5d4a">00463</a>     <span class="keywordtype">void</span> <a class="code" href="a00014.html#e747343dfc94f181f31471ceed7e5d4a" title="Sets the build mode of the matrix.">setBuildMode</a>(<a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ec" title="we support two modes">BuildMode</a> bm)
<a name="l00464"></a>00464     {
<a name="l00465"></a>00465       <span class="keywordflow">if</span>(ready==notbuilt)
<a name="l00466"></a>00466         build_mode = bm;
<a name="l00467"></a>00467       <span class="keywordflow">else</span>
<a name="l00468"></a>00468         DUNE_THROW(InvalidStateException, <span class="stringliteral">"Matrix structure is already built (ready="</span>&lt;&lt;ready&lt;&lt;<span class="stringliteral">")."</span>);
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470     
<a name="l00486"></a><a class="code" href="a00014.html#e89150f5ae2f2927657bddfb78610e55">00486</a>     <span class="keywordtype">void</span> <a class="code" href="a00014.html#e89150f5ae2f2927657bddfb78610e55" title="Set the size of the matrix.">setSize</a>(<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> rows, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> columns, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> nnz=0)
<a name="l00487"></a>00487     {
<a name="l00488"></a>00488       <span class="comment">// deallocate already setup memory</span>
<a name="l00489"></a>00489       deallocate();
<a name="l00490"></a>00490       
<a name="l00491"></a>00491       <span class="comment">// allocate matrix memory</span>
<a name="l00492"></a>00492       allocate(rows, columns, nnz);
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494     
<a name="l00496"></a><a class="code" href="a00014.html#2bdbdfb1376f047a9b45fa357ab13861">00496</a>     <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; <a class="code" href="a00014.html#2bdbdfb1376f047a9b45fa357ab13861" title="assignment">operator= </a>(<span class="keyword">const</span> <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; Mat)
<a name="l00497"></a>00497     {
<a name="l00498"></a>00498       <span class="comment">// return immediately when self-assignment</span>
<a name="l00499"></a>00499       <span class="keywordflow">if</span> (&amp;Mat==<span class="keyword">this</span>) <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00500"></a>00500       
<a name="l00501"></a>00501       <span class="comment">// make it simple: ALWAYS throw away memory for a and j</span>
<a name="l00502"></a>00502       deallocate(<span class="keyword">false</span>);
<a name="l00503"></a>00503       
<a name="l00504"></a>00504       <span class="comment">// reallocate the rows if required</span>
<a name="l00505"></a>00505       <span class="keywordflow">if</span> (n&gt;0 &amp;&amp; n!=Mat.<a class="code" href="a00014.html#b647dfcec2e9b6d7eb859e323d6fed66">n</a>)
<a name="l00506"></a>00506         <span class="comment">// free rows</span>
<a name="l00507"></a>00507         A::template free&lt;row_type&gt;(r); 
<a name="l00508"></a>00508       
<a name="l00509"></a>00509       nnz=Mat.<a class="code" href="a00014.html#1ff68b436b8f0a78b9318e9068a32274">nnz</a>;
<a name="l00510"></a>00510       <span class="keywordflow">if</span> (nnz&lt;=0)
<a name="l00511"></a>00511         {
<a name="l00512"></a>00512           <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i=0; i&lt;Mat.<a class="code" href="a00014.html#b647dfcec2e9b6d7eb859e323d6fed66">n</a>; i++)
<a name="l00513"></a>00513             nnz += Mat.<a class="code" href="a00014.html#811ac6c78bf57efe0f8e6204b486aba6">r</a>[i].<a class="code" href="a00036.html#da993a1e41ffc1452a45e002b9c773a9" title="get size">getsize</a>();
<a name="l00514"></a>00514         }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516       <span class="comment">// allocate a,j</span>
<a name="l00517"></a>00517       allocate(Mat.<a class="code" href="a00014.html#b647dfcec2e9b6d7eb859e323d6fed66">n</a>, Mat.<a class="code" href="a00014.html#1a629cfcdbb749dba27ad6bb972e033f">m</a>, nnz, n!=Mat.<a class="code" href="a00014.html#b647dfcec2e9b6d7eb859e323d6fed66">n</a>);
<a name="l00518"></a>00518       
<a name="l00519"></a>00519       <span class="comment">// build window structure</span>
<a name="l00520"></a>00520       copyWindowStructure(Mat);
<a name="l00521"></a>00521       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00522"></a>00522     }
<a name="l00523"></a>00523 
<a name="l00525"></a><a class="code" href="a00014.html#bcb3dea50ab1eac4cb2ab8955af19e82">00525</a>         <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; <a class="code" href="a00014.html#2bdbdfb1376f047a9b45fa357ab13861" title="assignment">operator= </a>(<span class="keyword">const</span> <a class="code" href="a00014.html#23ec4670373dbb79112f8a7f3ba7a785" title="export the type representing the field">field_type</a>&amp; k)
<a name="l00526"></a>00526         {
<a name="l00527"></a>00527             <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i=0; i&lt;n; i++) r[i] = k;
<a name="l00528"></a>00528             <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00529"></a>00529         }
<a name="l00530"></a>00530 
<a name="l00531"></a>00531         <span class="comment">//===== row-wise creation interface </span>
<a name="l00532"></a>00532 
<a name="l00534"></a><a class="code" href="a00015.html">00534</a>         <span class="keyword">class </span><a class="code" href="a00015.html" title="Iterator class for sequential creation of blocks">CreateIterator</a> 
<a name="l00535"></a>00535         {
<a name="l00536"></a>00536         <span class="keyword">public</span>:
<a name="l00538"></a><a class="code" href="a00015.html#7783414b8165d73990f91941a59a6d3f">00538</a>           <a class="code" href="a00015.html#7783414b8165d73990f91941a59a6d3f" title="constructor">CreateIterator</a> (<a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; _Mat, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> _i) 
<a name="l00539"></a>00539             : Mat(_Mat), i(_i), nnz(0), current_row(Mat.a, Mat.j, 0)
<a name="l00540"></a>00540           {
<a name="l00541"></a>00541                   <span class="keywordflow">if</span> (i==0 &amp;&amp; Mat.<a class="code" href="a00014.html#594b2bf93f559ed7c77f9f28e1338462">ready</a>)
<a name="l00542"></a>00542                     DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"creation only allowed for uninitialized matrix"</span>);
<a name="l00543"></a>00543                   <span class="keywordflow">if</span>(Mat.<a class="code" href="a00014.html#59d53fafbc0e1d8365f374781a542f26">build_mode</a>!=<a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecf7c450c73d8588d16cf4c65552b0ff18" title="Build in a row-wise manner.">row_wise</a>)
<a name="l00544"></a>00544       {
<a name="l00545"></a>00545                     <span class="keywordflow">if</span>(Mat.<a class="code" href="a00014.html#59d53fafbc0e1d8365f374781a542f26">build_mode</a>==<a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ec92b68407d7d0300588b1279b91838917" title="Build mode not set!">unknown</a>)
<a name="l00546"></a>00546                       Mat.<a class="code" href="a00014.html#59d53fafbc0e1d8365f374781a542f26">build_mode</a>=<a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecf7c450c73d8588d16cf4c65552b0ff18" title="Build in a row-wise manner.">row_wise</a>;
<a name="l00547"></a>00547                     <span class="keywordflow">else</span>
<a name="l00548"></a>00548                       DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"creation only allowed if row wise allocation was requested in the constructor"</span>);
<a name="l00549"></a>00549       }
<a name="l00550"></a>00550           }
<a name="l00551"></a>00551 
<a name="l00553"></a><a class="code" href="a00015.html#9e8befa999b60b84ab5ba710c1a81e3a">00553</a>           <a class="code" href="a00015.html" title="Iterator class for sequential creation of blocks">CreateIterator</a>&amp; <a class="code" href="a00015.html#9e8befa999b60b84ab5ba710c1a81e3a" title="prefix increment">operator++</a>()
<a name="l00554"></a>00554           {
<a name="l00555"></a>00555                 <span class="comment">// this should only be called if matrix is in creation</span>
<a name="l00556"></a>00556                 <span class="keywordflow">if</span> (Mat.<a class="code" href="a00014.html#594b2bf93f559ed7c77f9f28e1338462">ready</a>)
<a name="l00557"></a>00557                   DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"matrix already built up"</span>);
<a name="l00558"></a>00558 
<a name="l00559"></a>00559                 <span class="comment">// row i is defined through the pattern</span>
<a name="l00560"></a>00560                 <span class="comment">// get memory for the row and initialize the j array</span>
<a name="l00561"></a>00561                 <span class="comment">// this depends on the allocation mode</span>
<a name="l00562"></a>00562 
<a name="l00563"></a>00563                 <span class="comment">// compute size of the row</span>
<a name="l00564"></a>00564                 <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> s = pattern.size();
<a name="l00565"></a>00565 
<a name="l00566"></a>00566                 <span class="keywordflow">if</span>(s&gt;0){                  
<a name="l00567"></a>00567                   <span class="comment">// update number of nonzeroes including this row</span>
<a name="l00568"></a>00568                   nnz += s;
<a name="l00569"></a>00569                   
<a name="l00570"></a>00570                   <span class="comment">// alloc memory / set window</span>
<a name="l00571"></a>00571                   <span class="keywordflow">if</span> (Mat.<a class="code" href="a00014.html#1ff68b436b8f0a78b9318e9068a32274">nnz</a>&gt;0)
<a name="l00572"></a>00572                     {
<a name="l00573"></a>00573                       <span class="comment">// memory is allocated in one long array</span>
<a name="l00574"></a>00574 
<a name="l00575"></a>00575                       <span class="comment">// check if that memory is sufficient</span>
<a name="l00576"></a>00576                       <span class="keywordflow">if</span> (nnz&gt;Mat.<a class="code" href="a00014.html#1ff68b436b8f0a78b9318e9068a32274">nnz</a>) 
<a name="l00577"></a>00577                         DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"allocated nnz too small"</span>);
<a name="l00578"></a>00578                       
<a name="l00579"></a>00579                       <span class="comment">// set row i</span>
<a name="l00580"></a>00580                       Mat.<a class="code" href="a00014.html#811ac6c78bf57efe0f8e6204b486aba6">r</a>[i].<a class="code" href="a00036.html#27ff91272583127e5ffe568afe04d066" title="set size and pointer">set</a>(s,current_row.<a class="code" href="a00036.html#31d8e593c924c3714050d26b8cecfd5a" title="get pointer">getptr</a>(),current_row.<a class="code" href="a00036.html#fe4fc20a276763887fd925c90fd71688" title="get pointer">getindexptr</a>());
<a name="l00581"></a>00581                       current_row.<a class="code" href="a00036.html#8dd26d64c6836223d199e80e8bfd27db" title="set pointer only">setptr</a>(current_row.<a class="code" href="a00036.html#31d8e593c924c3714050d26b8cecfd5a" title="get pointer">getptr</a>()+s);
<a name="l00582"></a>00582                       current_row.<a class="code" href="a00036.html#d9548588dc9a90d3d3172821e2042693" title="set pointer only">setindexptr</a>(current_row.<a class="code" href="a00036.html#fe4fc20a276763887fd925c90fd71688" title="get pointer">getindexptr</a>()+s);
<a name="l00583"></a>00583                     }<span class="keywordflow">else</span>{
<a name="l00584"></a>00584                       <span class="comment">// memory is allocated individually per row</span>
<a name="l00585"></a>00585                       <span class="comment">// allocate and set row i</span>
<a name="l00586"></a>00586                       B*   a = A::template malloc&lt;B&gt;(s);
<a name="l00587"></a>00587                       <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a>* j = A::template malloc&lt;size_type&gt;(s);
<a name="l00588"></a>00588                       Mat.<a class="code" href="a00014.html#811ac6c78bf57efe0f8e6204b486aba6">r</a>[i].<a class="code" href="a00036.html#27ff91272583127e5ffe568afe04d066" title="set size and pointer">set</a>(s,a,j);
<a name="l00589"></a>00589                     }
<a name="l00590"></a>00590                 }<span class="keywordflow">else</span>
<a name="l00591"></a>00591                   <span class="comment">// setup empty row</span>
<a name="l00592"></a>00592                   Mat.<a class="code" href="a00014.html#811ac6c78bf57efe0f8e6204b486aba6">r</a>[i].<a class="code" href="a00036.html#27ff91272583127e5ffe568afe04d066" title="set size and pointer">set</a>(0,0,0);
<a name="l00593"></a>00593 
<a name="l00594"></a>00594                 <span class="comment">// initialize the j array for row i from pattern</span>
<a name="l00595"></a>00595                 <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> k=0;
<a name="l00596"></a>00596                 <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> *j =  Mat.<a class="code" href="a00014.html#811ac6c78bf57efe0f8e6204b486aba6">r</a>[i].<a class="code" href="a00036.html#fe4fc20a276763887fd925c90fd71688" title="get pointer">getindexptr</a>();
<a name="l00597"></a>00597                 <span class="keywordflow">for</span> (<span class="keyword">typename</span> std::set&lt;size_type&gt;::const_iterator it=pattern.begin(); it!=pattern.end(); ++it)
<a name="l00598"></a>00598                   j[k++] = *it;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600                 <span class="comment">// now go to next row</span>
<a name="l00601"></a>00601         i++;
<a name="l00602"></a>00602                 pattern.clear();
<a name="l00603"></a>00603 
<a name="l00604"></a>00604                 <span class="comment">// check if this was last row</span>
<a name="l00605"></a>00605                 <span class="keywordflow">if</span> (i==Mat.<a class="code" href="a00014.html#b647dfcec2e9b6d7eb859e323d6fed66">n</a>)
<a name="l00606"></a>00606                   {
<a name="l00607"></a>00607                         Mat.<a class="code" href="a00014.html#594b2bf93f559ed7c77f9f28e1338462">ready</a> = built;
<a name="l00608"></a>00608                         <span class="keywordflow">if</span>(Mat.<a class="code" href="a00014.html#1ff68b436b8f0a78b9318e9068a32274">nnz</a>&gt;0)
<a name="l00609"></a>00609                           <span class="comment">// Set nnz to the exact number of nonzero blocks inserted</span>
<a name="l00610"></a>00610                           <span class="comment">// as some methods rely on it</span>
<a name="l00611"></a>00611                           Mat.<a class="code" href="a00014.html#1ff68b436b8f0a78b9318e9068a32274">nnz</a>=nnz;
<a name="l00612"></a>00612                   }
<a name="l00613"></a>00613                 <span class="comment">// done</span>
<a name="l00614"></a>00614                 <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00615"></a>00615           }
<a name="l00616"></a>00616           
<a name="l00618"></a><a class="code" href="a00015.html#3625a787d1471e17649f4cbbca870902">00618</a>           <span class="keywordtype">bool</span> <a class="code" href="a00015.html#3625a787d1471e17649f4cbbca870902" title="inequality">operator!= </a>(<span class="keyword">const</span> <a class="code" href="a00015.html" title="Iterator class for sequential creation of blocks">CreateIterator</a>&amp; it)<span class="keyword"> const</span>
<a name="l00619"></a>00619 <span class="keyword">          </span>{
<a name="l00620"></a>00620         <span class="keywordflow">return</span> (i!=it.<a class="code" href="a00015.html#9a383afa725591bc38146e37278eaa84">i</a>) || (&amp;Mat!=&amp;it.<a class="code" href="a00015.html#87f0f76c01665f469bb90771d4b960d2">Mat</a>);
<a name="l00621"></a>00621           }
<a name="l00622"></a>00622 
<a name="l00624"></a><a class="code" href="a00015.html#c19925de5eba1e2fa81fcd8574147cea">00624</a>           <span class="keywordtype">bool</span> <a class="code" href="a00015.html#c19925de5eba1e2fa81fcd8574147cea" title="equality">operator== </a>(<span class="keyword">const</span> <a class="code" href="a00015.html" title="Iterator class for sequential creation of blocks">CreateIterator</a>&amp; it)<span class="keyword"> const</span>
<a name="l00625"></a>00625 <span class="keyword">          </span>{
<a name="l00626"></a>00626         <span class="keywordflow">return</span> (i==it.<a class="code" href="a00015.html#9a383afa725591bc38146e37278eaa84">i</a>) &amp;&amp; (&amp;Mat==&amp;it.<a class="code" href="a00015.html#87f0f76c01665f469bb90771d4b960d2">Mat</a>);
<a name="l00627"></a>00627           }
<a name="l00628"></a>00628 
<a name="l00630"></a><a class="code" href="a00015.html#693c47ec5fbb3c8b1b779a41bb907938">00630</a>           <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> <a class="code" href="a00015.html#693c47ec5fbb3c8b1b779a41bb907938" title="dereferencing">index</a> ()<span class="keyword"> const</span>
<a name="l00631"></a>00631 <span class="keyword">          </span>{
<a name="l00632"></a>00632         <span class="keywordflow">return</span> i;
<a name="l00633"></a>00633           }
<a name="l00634"></a>00634 
<a name="l00636"></a><a class="code" href="a00015.html#a5d5922fa50decc42cb164bee0a6b81e">00636</a>           <span class="keywordtype">void</span> <a class="code" href="a00015.html#a5d5922fa50decc42cb164bee0a6b81e" title="put column index in row">insert</a> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> j)
<a name="l00637"></a>00637           {
<a name="l00638"></a>00638                 pattern.insert(j);
<a name="l00639"></a>00639           }
<a name="l00640"></a>00640 
<a name="l00642"></a><a class="code" href="a00015.html#cddb385fa2e594243b0d35ed3df8d760">00642</a>           <span class="keywordtype">bool</span> <a class="code" href="a00015.html#cddb385fa2e594243b0d35ed3df8d760" title="return true if column index is in row">contains</a> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> j)
<a name="l00643"></a>00643           {
<a name="l00644"></a>00644                 <span class="keywordflow">if</span> (pattern.find(j)!=pattern.end())
<a name="l00645"></a>00645                   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00646"></a>00646                 <span class="keywordflow">else</span>
<a name="l00647"></a>00647                   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00648"></a>00648           }
<a name="l00654"></a><a class="code" href="a00015.html#49b88df773a6f993afd987befbd71457">00654</a>           <span class="keyword">typename</span> std::set&lt;size_type&gt;::size_type <a class="code" href="a00015.html#49b88df773a6f993afd987befbd71457" title="Get the current row size.">size</a>()<span class="keyword"> const</span>
<a name="l00655"></a>00655 <span class="keyword">          </span>{
<a name="l00656"></a>00656             <span class="keywordflow">return</span> pattern.size();
<a name="l00657"></a>00657           }
<a name="l00658"></a>00658           
<a name="l00659"></a>00659         <span class="keyword">private</span>:
<a name="l00660"></a>00660           <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; Mat; <span class="comment">// the matrix we are defining</span>
<a name="l00661"></a>00661           <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i;           <span class="comment">// current row to be defined </span>
<a name="l00662"></a>00662           <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> nnz;         <span class="comment">// count total number of nonzeros</span>
<a name="l00663"></a>00663           std::set&lt;size_type&gt; pattern; <span class="comment">// used to compile entries in a row</span>
<a name="l00664"></a>00664           <a class="code" href="a00036.html">row_type</a> current_row; <span class="comment">// row poiting to the current row to setup</span>
<a name="l00665"></a>00665         };
<a name="l00666"></a>00666 
<a name="l00668"></a><a class="code" href="a00014.html#0e3d1a15a1c40f30085bd50393372d7b">00668</a>         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="a00015.html" title="Iterator class for sequential creation of blocks">CreateIterator</a>;
<a name="l00669"></a>00669 
<a name="l00671"></a><a class="code" href="a00014.html#b9217545ae9d4ea1e3950cf21e6899c4">00671</a>         <a class="code" href="a00015.html" title="Iterator class for sequential creation of blocks">CreateIterator</a> <a class="code" href="a00014.html#b9217545ae9d4ea1e3950cf21e6899c4" title="get initial create iterator">createbegin</a> ()
<a name="l00672"></a>00672         {
<a name="l00673"></a>00673           <span class="keywordflow">return</span> <a class="code" href="a00014.html#0e3d1a15a1c40f30085bd50393372d7b" title="allow CreateIterator to access internal data">CreateIterator</a>(*<span class="keyword">this</span>,0);
<a name="l00674"></a>00674         }
<a name="l00675"></a>00675 
<a name="l00677"></a><a class="code" href="a00014.html#a0839499f658a2d3e7a5ea908cc86130">00677</a>         <a class="code" href="a00015.html" title="Iterator class for sequential creation of blocks">CreateIterator</a> <a class="code" href="a00014.html#a0839499f658a2d3e7a5ea908cc86130" title="get create iterator pointing to one after the last block">createend</a> ()
<a name="l00678"></a>00678         {
<a name="l00679"></a>00679           <span class="keywordflow">return</span> <a class="code" href="a00014.html#0e3d1a15a1c40f30085bd50393372d7b" title="allow CreateIterator to access internal data">CreateIterator</a>(*<span class="keyword">this</span>,n);
<a name="l00680"></a>00680         }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 
<a name="l00683"></a>00683         <span class="comment">//===== random creation interface </span>
<a name="l00684"></a>00684 
<a name="l00686"></a><a class="code" href="a00014.html#5a8fdcc48798af5363b9fd8cdf2a4dac">00686</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#5a8fdcc48798af5363b9fd8cdf2a4dac" title="set number of indices in row i to s">setrowsize</a> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> s)
<a name="l00687"></a>00687         {
<a name="l00688"></a>00688           <span class="keywordflow">if</span> (build_mode!=<a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecd05f70b8e286d23abee639a8d50552e3" title="Build entries randomly.">random</a>)
<a name="l00689"></a>00689                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"requires random build mode"</span>);       
<a name="l00690"></a>00690           <span class="keywordflow">if</span> (ready)
<a name="l00691"></a>00691                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"matrix row sizes already built up"</span>);
<a name="l00692"></a>00692 
<a name="l00693"></a>00693           r[i].<a class="code" href="a00036.html#3c7ccba105dd6d093780e1b9f9cb72f6" title="set size only">setsize</a>(s);
<a name="l00694"></a>00694         }
<a name="l00695"></a>00695 
<a name="l00697"></a><a class="code" href="a00014.html#36215e4fa1297d767ac8eb5cd735601b">00697</a>         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> <a class="code" href="a00014.html#36215e4fa1297d767ac8eb5cd735601b" title="get current number of indices in row i">getrowsize</a> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i)<span class="keyword"> const</span>
<a name="l00698"></a>00698 <span class="keyword">        </span>{
<a name="l00699"></a>00699 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l00700"></a>00700 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (r==0) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"row not initialized yet"</span>);
<a name="l00701"></a>00701           <span class="keywordflow">if</span> (i&gt;=n) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00702"></a>00702 <span class="preprocessor">#endif</span>
<a name="l00703"></a>00703 <span class="preprocessor"></span>          <span class="keywordflow">return</span> r[i].<a class="code" href="a00036.html#da993a1e41ffc1452a45e002b9c773a9" title="get size">getsize</a>();
<a name="l00704"></a>00704         }
<a name="l00705"></a>00705 
<a name="l00707"></a><a class="code" href="a00014.html#41e41b7274abb109855e80f76a66f4d7">00707</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#41e41b7274abb109855e80f76a66f4d7" title="increment size of row i by s (1 by default)">incrementrowsize</a> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> s = 1)
<a name="l00708"></a>00708         {
<a name="l00709"></a>00709           <span class="keywordflow">if</span> (build_mode!=<a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecd05f70b8e286d23abee639a8d50552e3" title="Build entries randomly.">random</a>)
<a name="l00710"></a>00710                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"requires random build mode"</span>);       
<a name="l00711"></a>00711           <span class="keywordflow">if</span> (ready)
<a name="l00712"></a>00712                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"matrix row sizes already built up"</span>);
<a name="l00713"></a>00713 
<a name="l00714"></a>00714           r[i].<a class="code" href="a00036.html#3c7ccba105dd6d093780e1b9f9cb72f6" title="set size only">setsize</a>(r[i].getsize()+s);
<a name="l00715"></a>00715         }
<a name="l00716"></a>00716 
<a name="l00718"></a><a class="code" href="a00014.html#3ebc537e4755cf1ab02ea0dd93c942fb">00718</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#3ebc537e4755cf1ab02ea0dd93c942fb" title="indicate that size of all rows is defined">endrowsizes</a> ()
<a name="l00719"></a>00719         {
<a name="l00720"></a>00720           <span class="keywordflow">if</span> (build_mode!=<a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecd05f70b8e286d23abee639a8d50552e3" title="Build entries randomly.">random</a>)
<a name="l00721"></a>00721                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"requires random build mode"</span>);       
<a name="l00722"></a>00722           <span class="keywordflow">if</span> (ready)
<a name="l00723"></a>00723                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"matrix row sizes already built up"</span>);
<a name="l00724"></a>00724 
<a name="l00725"></a>00725           <span class="comment">// compute total size, check positivity</span>
<a name="l00726"></a>00726           <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> total=0;
<a name="l00727"></a>00727           <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i=0; i&lt;n; i++)
<a name="l00728"></a>00728                 {
<a name="l00729"></a>00729                     <span class="keywordflow">if</span> (r[i].getsize()&lt;0)
<a name="l00730"></a>00730                         DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"rowsize must be nonnegative"</span>);      
<a name="l00731"></a>00731                   total += r[i].<a class="code" href="a00036.html#da993a1e41ffc1452a45e002b9c773a9" title="get size">getsize</a>();
<a name="l00732"></a>00732                 }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734           <span class="comment">// allocate/check memory</span>
<a name="l00735"></a>00735           allocate(n,m,total,<span class="keyword">false</span>);
<a name="l00736"></a>00736           
<a name="l00737"></a>00737           <span class="comment">// set the window pointers correctly</span>
<a name="l00738"></a>00738           setWindowPointers(<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>());
<a name="l00739"></a>00739           
<a name="l00740"></a>00740           <span class="comment">// initialize j array with m (an invalid column index)</span>
<a name="l00741"></a>00741           <span class="comment">// this indicates an unused entry</span>
<a name="l00742"></a>00742           <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> k=0; k&lt;nnz; k++)
<a name="l00743"></a>00743                 j[k] = m;
<a name="l00744"></a>00744           ready = rowSizesBuilt;
<a name="l00745"></a>00745         }
<a name="l00746"></a>00746 
<a name="l00748"></a>00748 
<a name="l00758"></a><a class="code" href="a00014.html#82d12c2fa3e3e956e4257aed1bf247ec">00758</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#82d12c2fa3e3e956e4257aed1bf247ec" title="add index (row,col) to the matrix">addindex</a> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> row, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> col)
<a name="l00759"></a>00759         {
<a name="l00760"></a>00760           <span class="keywordflow">if</span> (build_mode!=<a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecd05f70b8e286d23abee639a8d50552e3" title="Build entries randomly.">random</a>)
<a name="l00761"></a>00761                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"requires random build mode"</span>);       
<a name="l00762"></a>00762           <span class="keywordflow">if</span> (ready==built)
<a name="l00763"></a>00763                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"matrix already built up"</span>);          
<a name="l00764"></a>00764           <span class="keywordflow">if</span> (ready==notbuilt)
<a name="l00765"></a>00765                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"matrix row sizes not built up yet"</span>);
<a name="l00766"></a>00766 
<a name="l00767"></a>00767           <span class="keywordflow">if</span> (col &gt;= m)
<a name="l00768"></a>00768             DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"column index exceeds matrix size"</span>);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770           <span class="comment">// get row range</span>
<a name="l00771"></a>00771           <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a>* <span class="keyword">const</span> first = r[row].<a class="code" href="a00036.html#fe4fc20a276763887fd925c90fd71688" title="get pointer">getindexptr</a>();
<a name="l00772"></a>00772           <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a>* <span class="keyword">const</span> last = first + r[row].<a class="code" href="a00036.html#da993a1e41ffc1452a45e002b9c773a9" title="get size">getsize</a>();
<a name="l00773"></a>00773 
<a name="l00774"></a>00774           <span class="comment">// find correct insertion position for new column index</span>
<a name="l00775"></a>00775           <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a>* pos = std::lower_bound(first,last,col);
<a name="l00776"></a>00776 
<a name="l00777"></a>00777           <span class="comment">// check if index is already in row</span>
<a name="l00778"></a>00778           <span class="keywordflow">if</span> (pos!=last &amp;&amp; *pos == col) <span class="keywordflow">return</span>;
<a name="l00779"></a>00779 
<a name="l00780"></a>00780           <span class="comment">// find end of already inserted column indices</span>
<a name="l00781"></a>00781           <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a>* <a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a> = std::lower_bound(pos,last,m);
<a name="l00782"></a>00782           <span class="keywordflow">if</span> (end==last)
<a name="l00783"></a>00783             DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"row is too small"</span>);
<a name="l00784"></a>00784 
<a name="l00785"></a>00785           <span class="comment">// insert new column index at correct position</span>
<a name="l00786"></a>00786           std::copy_backward(pos,end,end+1);
<a name="l00787"></a>00787           *pos = col;
<a name="l00788"></a>00788 
<a name="l00789"></a>00789         }
<a name="l00790"></a>00790 
<a name="l00792"></a><a class="code" href="a00014.html#ceeae57760ab2b4c297f19ac8522eef6">00792</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#ceeae57760ab2b4c297f19ac8522eef6" title="indicate that all indices are defined, check consistency">endindices</a> ()
<a name="l00793"></a>00793         {
<a name="l00794"></a>00794           <span class="keywordflow">if</span> (build_mode!=<a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecd05f70b8e286d23abee639a8d50552e3" title="Build entries randomly.">random</a>)
<a name="l00795"></a>00795                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"requires random build mode"</span>);       
<a name="l00796"></a>00796           <span class="keywordflow">if</span> (ready==built)
<a name="l00797"></a>00797                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"matrix already built up"</span>);
<a name="l00798"></a>00798           <span class="keywordflow">if</span> (ready==notbuilt)
<a name="l00799"></a>00799             DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"row sizes are not built up yet"</span>);
<a name="l00800"></a>00800 
<a name="l00801"></a>00801           <span class="comment">// check if there are undefined indices</span>
<a name="l00802"></a>00802           <a class="code" href="a00016.html" title="Iterator access to matrix rows">RowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l00803"></a>00803           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">RowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l00804"></a>00804                 {
<a name="l00805"></a>00805                   <a class="code" href="a00034.html" title="iterator class for sequential access">ColIterator</a> endj = (*i).end();
<a name="l00806"></a>00806                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ColIterator</a> j=(*i).begin(); j!=endj; ++j){
<a name="l00807"></a>00807                         <span class="keywordflow">if</span> (j.index()&lt;0)
<a name="l00808"></a>00808                           {
<a name="l00809"></a>00809                                 std::cout &lt;&lt; <span class="stringliteral">"j["</span> &lt;&lt; j.offset() &lt;&lt; <span class="stringliteral">"]="</span> &lt;&lt; j.index() &lt;&lt; std::endl;
<a name="l00810"></a>00810                                 DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"undefined index detected"</span>);
<a name="l00811"></a>00811                           }
<a name="l00812"></a>00812                         <span class="keywordflow">if</span> (j.index()&gt;=m){
<a name="l00813"></a>00813                           dwarn &lt;&lt; <span class="stringliteral">"WARNING: size of row "</span>&lt;&lt; i.index()&lt;&lt;<span class="stringliteral">" is "</span>&lt;&lt;j.offset()&lt;&lt;<span class="stringliteral">". But was specified as being "</span>&lt;&lt; (*i).end().offset()
<a name="l00814"></a>00814                           &lt;&lt;<span class="stringliteral">". This means you are wasting valuable space and creating additional cache misses!"</span>&lt;&lt;std::endl;
<a name="l00815"></a>00815                           r[i.index()].<a class="code" href="a00036.html#3c7ccba105dd6d093780e1b9f9cb72f6" title="set size only">setsize</a>(j.offset());
<a name="l00816"></a>00816                           <span class="keywordflow">break</span>;
<a name="l00817"></a>00817                         }
<a name="l00818"></a>00818                   }
<a name="l00819"></a>00819           }
<a name="l00820"></a>00820 
<a name="l00821"></a>00821           <span class="comment">// if not, set matrix to built</span>
<a name="l00822"></a>00822           ready = built;
<a name="l00823"></a>00823         }
<a name="l00824"></a>00824 
<a name="l00825"></a>00825         <span class="comment">//===== vector space arithmetic</span>
<a name="l00826"></a>00826 
<a name="l00828"></a><a class="code" href="a00014.html#d59f6d33e271ed3acd9223b9535913a4">00828</a>         <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; <a class="code" href="a00014.html#d59f6d33e271ed3acd9223b9535913a4" title="vector space multiplication with scalar">operator*= </a>(<span class="keyword">const</span> <a class="code" href="a00014.html#23ec4670373dbb79112f8a7f3ba7a785" title="export the type representing the field">field_type</a>&amp; k)
<a name="l00829"></a>00829         {
<a name="l00830"></a>00830           <span class="keywordflow">if</span> (nnz&gt;0)
<a name="l00831"></a>00831                 {
<a name="l00832"></a>00832                   <span class="comment">// process 1D array</span>
<a name="l00833"></a>00833                   <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i=0; i&lt;nnz; i++)
<a name="l00834"></a>00834                         a[i] *= k;
<a name="l00835"></a>00835                 }
<a name="l00836"></a>00836           <span class="keywordflow">else</span>
<a name="l00837"></a>00837                 {
<a name="l00838"></a>00838                   <a class="code" href="a00016.html" title="Iterator access to matrix rows">RowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l00839"></a>00839                   <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">RowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l00840"></a>00840                         {
<a name="l00841"></a>00841                           <a class="code" href="a00034.html" title="iterator class for sequential access">ColIterator</a> endj = (*i).end();
<a name="l00842"></a>00842                           <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l00843"></a>00843                                 (*j) *= k;
<a name="l00844"></a>00844                         }
<a name="l00845"></a>00845                 }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847           <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00848"></a>00848         }
<a name="l00849"></a>00849 
<a name="l00851"></a><a class="code" href="a00014.html#7177e68fadef1d8054c232815759b595">00851</a>         <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; <a class="code" href="a00014.html#7177e68fadef1d8054c232815759b595" title="vector space division by scalar">operator/= </a>(<span class="keyword">const</span> <a class="code" href="a00014.html#23ec4670373dbb79112f8a7f3ba7a785" title="export the type representing the field">field_type</a>&amp; k)
<a name="l00852"></a>00852         {
<a name="l00853"></a>00853           <span class="keywordflow">if</span> (nnz&gt;0)
<a name="l00854"></a>00854                 {
<a name="l00855"></a>00855                   <span class="comment">// process 1D array</span>
<a name="l00856"></a>00856                   <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i=0; i&lt;nnz; i++)
<a name="l00857"></a>00857                         a[i] /= k;
<a name="l00858"></a>00858                 }
<a name="l00859"></a>00859           <span class="keywordflow">else</span>
<a name="l00860"></a>00860                 {
<a name="l00861"></a>00861                   <a class="code" href="a00016.html" title="Iterator access to matrix rows">RowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l00862"></a>00862                   <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">RowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l00863"></a>00863                         {
<a name="l00864"></a>00864                           <a class="code" href="a00034.html" title="iterator class for sequential access">ColIterator</a> endj = (*i).end();
<a name="l00865"></a>00865                           <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l00866"></a>00866                                 (*j) /= k;
<a name="l00867"></a>00867                         }
<a name="l00868"></a>00868                 }
<a name="l00869"></a>00869 
<a name="l00870"></a>00870           <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00871"></a>00871         }
<a name="l00872"></a>00872 
<a name="l00873"></a>00873 
<a name="l00879"></a><a class="code" href="a00014.html#a326dc908b26901ec421d3894904f366">00879</a>         <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; <a class="code" href="a00014.html#a326dc908b26901ec421d3894904f366" title="Add the entries of another matrix to this one.">operator+= </a>(<span class="keyword">const</span> <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; b)
<a name="l00880"></a>00880         {
<a name="l00881"></a>00881 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l00882"></a>00882 <span class="preprocessor"></span>          <span class="keywordflow">if</span>(<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()!=b.<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>() || <a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>() != b.<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>())
<a name="l00883"></a>00883             DUNE_THROW(RangeError, <span class="stringliteral">"Matrix sizes do not match!"</span>);
<a name="l00884"></a>00884 <span class="preprocessor">#endif</span>
<a name="l00885"></a>00885 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">RowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l00886"></a>00886           <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> j=b.<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>();
<a name="l00887"></a>00887           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">RowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i, ++j){
<a name="l00888"></a>00888             i-&gt;operator+=(*j);
<a name="l00889"></a>00889           }
<a name="l00890"></a>00890         
<a name="l00891"></a>00891           <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893 
<a name="l00899"></a><a class="code" href="a00014.html#cef4af977012c9eb300262c32079f48f">00899</a>         <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; <a class="code" href="a00014.html#cef4af977012c9eb300262c32079f48f" title="Substract the entries of another matrix to this one.">operator-= </a>(<span class="keyword">const</span> <a class="code" href="a00014.html" title="A sparse block matrix with compressed row storage.">BCRSMatrix</a>&amp; b)
<a name="l00900"></a>00900         {
<a name="l00901"></a>00901 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l00902"></a>00902 <span class="preprocessor"></span>          <span class="keywordflow">if</span>(<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()!=b.<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>() || <a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>() != b.<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>())
<a name="l00903"></a>00903             DUNE_THROW(RangeError, <span class="stringliteral">"Matrix sizes do not match!"</span>);
<a name="l00904"></a>00904 <span class="preprocessor">#endif</span>
<a name="l00905"></a>00905 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">RowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l00906"></a>00906           <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> j=b.<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>();
<a name="l00907"></a>00907           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">RowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i, ++j){
<a name="l00908"></a>00908             i-&gt;operator-=(*j);
<a name="l00909"></a>00909           }
<a name="l00910"></a>00910         
<a name="l00911"></a>00911           <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00912"></a>00912         }
<a name="l00913"></a>00913         <span class="comment">//===== linear maps</span>
<a name="l00914"></a>00914    
<a name="l00916"></a>00916         <span class="keyword">template</span>&lt;<span class="keyword">class</span> X, <span class="keyword">class</span> Y&gt;
<a name="l00917"></a><a class="code" href="a00014.html#57a39767a19888a3159c241bcd1998c1">00917</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#57a39767a19888a3159c241bcd1998c1" title="y = A x">mv</a> (<span class="keyword">const</span> X&amp; x, Y&amp; y)<span class="keyword"> const</span>
<a name="l00918"></a>00918 <span class="keyword">        </span>{
<a name="l00919"></a>00919 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l00920"></a>00920 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (x.N()!=<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00921"></a>00921           <span class="keywordflow">if</span> (y.N()!=<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00922"></a>00922 <span class="preprocessor">#endif</span>
<a name="l00923"></a>00923 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l00924"></a>00924           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l00925"></a>00925                 {
<a name="l00926"></a>00926                   y[i.index()]=0;
<a name="l00927"></a>00927                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l00928"></a>00928                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l00929"></a>00929                         (*j).umv(x[j.index()],y[i.index()]);
<a name="l00930"></a>00930                 }
<a name="l00931"></a>00931         }
<a name="l00932"></a>00932 
<a name="l00934"></a>00934         <span class="keyword">template</span>&lt;<span class="keyword">class</span> X, <span class="keyword">class</span> Y&gt;
<a name="l00935"></a><a class="code" href="a00014.html#eb749deb8c27983f4387f0fe27c8fbe1">00935</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#eb749deb8c27983f4387f0fe27c8fbe1" title="y += A x">umv</a> (<span class="keyword">const</span> X&amp; x, Y&amp; y)<span class="keyword"> const</span>
<a name="l00936"></a>00936 <span class="keyword">        </span>{
<a name="l00937"></a>00937 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l00938"></a>00938 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (x.N()!=<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00939"></a>00939           <span class="keywordflow">if</span> (y.N()!=<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00940"></a>00940 <span class="preprocessor">#endif</span>
<a name="l00941"></a>00941 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l00942"></a>00942           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l00943"></a>00943                 {
<a name="l00944"></a>00944                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l00945"></a>00945                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l00946"></a>00946                         (*j).umv(x[j.index()],y[i.index()]);
<a name="l00947"></a>00947                 }
<a name="l00948"></a>00948         }
<a name="l00949"></a>00949 
<a name="l00951"></a>00951         <span class="keyword">template</span>&lt;<span class="keyword">class</span> X, <span class="keyword">class</span> Y&gt;
<a name="l00952"></a><a class="code" href="a00014.html#62dabc0f4e3eabb19b6f938ddb644cd7">00952</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#62dabc0f4e3eabb19b6f938ddb644cd7" title="y -= A x">mmv</a> (<span class="keyword">const</span> X&amp; x, Y&amp; y)<span class="keyword"> const</span>
<a name="l00953"></a>00953 <span class="keyword">        </span>{
<a name="l00954"></a>00954 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l00955"></a>00955 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (x.N()!=<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00956"></a>00956           <span class="keywordflow">if</span> (y.N()!=<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00957"></a>00957 <span class="preprocessor">#endif</span>
<a name="l00958"></a>00958 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l00959"></a>00959           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l00960"></a>00960                 {
<a name="l00961"></a>00961                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l00962"></a>00962                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l00963"></a>00963                         (*j).mmv(x[j.index()],y[i.index()]);
<a name="l00964"></a>00964                 }
<a name="l00965"></a>00965         }
<a name="l00966"></a>00966 
<a name="l00968"></a>00968         <span class="keyword">template</span>&lt;<span class="keyword">class</span> X, <span class="keyword">class</span> Y&gt;
<a name="l00969"></a><a class="code" href="a00014.html#5b77355661313b46949cd3b8c45eabb0">00969</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#5b77355661313b46949cd3b8c45eabb0" title="y += alpha A x">usmv</a> (<span class="keyword">const</span> <a class="code" href="a00014.html#23ec4670373dbb79112f8a7f3ba7a785" title="export the type representing the field">field_type</a>&amp; alpha, <span class="keyword">const</span> X&amp; x, Y&amp; y)<span class="keyword"> const</span>
<a name="l00970"></a>00970 <span class="keyword">        </span>{
<a name="l00971"></a>00971 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l00972"></a>00972 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (x.N()!=<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00973"></a>00973           <span class="keywordflow">if</span> (y.N()!=<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00974"></a>00974 <span class="preprocessor">#endif</span>
<a name="l00975"></a>00975 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l00976"></a>00976           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l00977"></a>00977                 {
<a name="l00978"></a>00978                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l00979"></a>00979                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l00980"></a>00980                         (*j).usmv(alpha,x[j.index()],y[i.index()]);
<a name="l00981"></a>00981                 }
<a name="l00982"></a>00982         }
<a name="l00983"></a>00983 
<a name="l00985"></a>00985         <span class="keyword">template</span>&lt;<span class="keyword">class</span> X, <span class="keyword">class</span> Y&gt;
<a name="l00986"></a><a class="code" href="a00014.html#cb25d28750e288095adf61990afbc9ef">00986</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#cb25d28750e288095adf61990afbc9ef" title="y += A^T x">umtv</a> (<span class="keyword">const</span> X&amp; x, Y&amp; y)<span class="keyword"> const</span>
<a name="l00987"></a>00987 <span class="keyword">        </span>{
<a name="l00988"></a>00988 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l00989"></a>00989 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (x.N()!=<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00990"></a>00990           <span class="keywordflow">if</span> (y.N()!=<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l00991"></a>00991 <span class="preprocessor">#endif</span>
<a name="l00992"></a>00992 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l00993"></a>00993           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l00994"></a>00994                 {
<a name="l00995"></a>00995                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l00996"></a>00996                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l00997"></a>00997                         (*j).umtv(x[i.index()],y[j.index()]);
<a name="l00998"></a>00998                 }
<a name="l00999"></a>00999         }
<a name="l01000"></a>01000 
<a name="l01002"></a>01002         <span class="keyword">template</span>&lt;<span class="keyword">class</span> X, <span class="keyword">class</span> Y&gt;
<a name="l01003"></a><a class="code" href="a00014.html#576b6c09fd375230d7fc7b363fe7d70e">01003</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#576b6c09fd375230d7fc7b363fe7d70e" title="y -= A^T x">mmtv</a> (<span class="keyword">const</span> X&amp; x, Y&amp; y)<span class="keyword"> const</span>
<a name="l01004"></a>01004 <span class="keyword">        </span>{
<a name="l01005"></a>01005 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l01006"></a>01006 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (x.N()!=<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01007"></a>01007           <span class="keywordflow">if</span> (y.N()!=<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01008"></a>01008 <span class="preprocessor">#endif</span>
<a name="l01009"></a>01009 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l01010"></a>01010           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l01011"></a>01011                 {
<a name="l01012"></a>01012                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l01013"></a>01013                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l01014"></a>01014                         (*j).mmtv(x[i.index()],y[j.index()]);
<a name="l01015"></a>01015                 }
<a name="l01016"></a>01016         }
<a name="l01017"></a>01017 
<a name="l01019"></a>01019         <span class="keyword">template</span>&lt;<span class="keyword">class</span> X, <span class="keyword">class</span> Y&gt;
<a name="l01020"></a><a class="code" href="a00014.html#816e40691a1edcdb29bcf9d9bd469015">01020</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#816e40691a1edcdb29bcf9d9bd469015" title="y += alpha A^T x">usmtv</a> (<span class="keyword">const</span> <a class="code" href="a00014.html#23ec4670373dbb79112f8a7f3ba7a785" title="export the type representing the field">field_type</a>&amp; alpha, <span class="keyword">const</span> X&amp; x, Y&amp; y)<span class="keyword"> const</span>
<a name="l01021"></a>01021 <span class="keyword">        </span>{
<a name="l01022"></a>01022 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l01023"></a>01023 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (x.N()!=<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01024"></a>01024           <span class="keywordflow">if</span> (y.N()!=<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01025"></a>01025 <span class="preprocessor">#endif</span>
<a name="l01026"></a>01026 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l01027"></a>01027           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l01028"></a>01028                 {
<a name="l01029"></a>01029                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l01030"></a>01030                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l01031"></a>01031                         (*j).usmtv(alpha,x[i.index()],y[j.index()]);
<a name="l01032"></a>01032                 }
<a name="l01033"></a>01033         }
<a name="l01034"></a>01034           
<a name="l01036"></a>01036         <span class="keyword">template</span>&lt;<span class="keyword">class</span> X, <span class="keyword">class</span> Y&gt;
<a name="l01037"></a><a class="code" href="a00014.html#15f6616cb4b8d564047ef1c461a0a162">01037</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#15f6616cb4b8d564047ef1c461a0a162" title="y += A^H x">umhv</a> (<span class="keyword">const</span> X&amp; x, Y&amp; y)<span class="keyword"> const</span>
<a name="l01038"></a>01038 <span class="keyword">        </span>{
<a name="l01039"></a>01039 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l01040"></a>01040 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (x.N()!=<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01041"></a>01041           <span class="keywordflow">if</span> (y.N()!=<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01042"></a>01042 <span class="preprocessor">#endif</span>
<a name="l01043"></a>01043 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l01044"></a>01044           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l01045"></a>01045                 {
<a name="l01046"></a>01046                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l01047"></a>01047                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l01048"></a>01048                         (*j).umhv(x[i.index()],y[j.index()]);
<a name="l01049"></a>01049                 }
<a name="l01050"></a>01050         }
<a name="l01051"></a>01051 
<a name="l01053"></a>01053         <span class="keyword">template</span>&lt;<span class="keyword">class</span> X, <span class="keyword">class</span> Y&gt;
<a name="l01054"></a><a class="code" href="a00014.html#82597b8c6065ee868e6efa607b3864c3">01054</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#82597b8c6065ee868e6efa607b3864c3" title="y -= A^H x">mmhv</a> (<span class="keyword">const</span> X&amp; x, Y&amp; y)<span class="keyword"> const</span>
<a name="l01055"></a>01055 <span class="keyword">        </span>{
<a name="l01056"></a>01056 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l01057"></a>01057 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (x.N()!=<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01058"></a>01058           <span class="keywordflow">if</span> (y.N()!=<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01059"></a>01059 <span class="preprocessor">#endif</span>
<a name="l01060"></a>01060 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l01061"></a>01061           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l01062"></a>01062                 {
<a name="l01063"></a>01063                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l01064"></a>01064                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l01065"></a>01065                         (*j).mmhv(x[i.index()],y[j.index()]);
<a name="l01066"></a>01066                 }
<a name="l01067"></a>01067         }
<a name="l01068"></a>01068 
<a name="l01070"></a>01070         <span class="keyword">template</span>&lt;<span class="keyword">class</span> X, <span class="keyword">class</span> Y&gt;
<a name="l01071"></a><a class="code" href="a00014.html#e70145a540ff269ba0b7196992c8bebf">01071</a>         <span class="keywordtype">void</span> <a class="code" href="a00014.html#e70145a540ff269ba0b7196992c8bebf" title="y += alpha A^H x">usmhv</a> (<span class="keyword">const</span> <a class="code" href="a00014.html#23ec4670373dbb79112f8a7f3ba7a785" title="export the type representing the field">field_type</a>&amp; alpha, <span class="keyword">const</span> X&amp; x, Y&amp; y)<span class="keyword"> const</span>
<a name="l01072"></a>01072 <span class="keyword">        </span>{
<a name="l01073"></a>01073 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l01074"></a>01074 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (x.N()!=<a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01075"></a>01075           <span class="keywordflow">if</span> (y.N()!=<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>()) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01076"></a>01076 <span class="preprocessor">#endif</span>
<a name="l01077"></a>01077 <span class="preprocessor"></span>          <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l01078"></a>01078           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l01079"></a>01079                 {
<a name="l01080"></a>01080                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l01081"></a>01081                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l01082"></a>01082                         (*j).usmhv(alpha,x[i.index()],y[j.index()]);
<a name="l01083"></a>01083                 }
<a name="l01084"></a>01084         }
<a name="l01085"></a>01085           
<a name="l01086"></a>01086 
<a name="l01087"></a>01087         <span class="comment">//===== norms</span>
<a name="l01088"></a>01088 
<a name="l01090"></a><a class="code" href="a00014.html#9c8e2fedb9b5eea0a6808f5be43ebe2b">01090</a>     <span class="keywordtype">double</span> <a class="code" href="a00014.html#9c8e2fedb9b5eea0a6808f5be43ebe2b" title="square of frobenius norm, need for block recursion">frobenius_norm2</a> ()<span class="keyword"> const</span>
<a name="l01091"></a>01091 <span class="keyword">        </span>{
<a name="l01092"></a>01092           <span class="keywordtype">double</span> sum=0;
<a name="l01093"></a>01093 
<a name="l01094"></a>01094           <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l01095"></a>01095           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l01096"></a>01096                 {
<a name="l01097"></a>01097                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l01098"></a>01098                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l01099"></a>01099                         sum += (*j).frobenius_norm2();
<a name="l01100"></a>01100                 }
<a name="l01101"></a>01101 
<a name="l01102"></a>01102           <span class="keywordflow">return</span> sum;
<a name="l01103"></a>01103         }
<a name="l01104"></a>01104 
<a name="l01106"></a><a class="code" href="a00014.html#9e81dd7f54974b262f790f764628825f">01106</a>     <span class="keywordtype">double</span> <a class="code" href="a00014.html#9e81dd7f54974b262f790f764628825f" title="frobenius norm: sqrt(sum over squared values of entries)">frobenius_norm</a> ()<span class="keyword"> const</span>
<a name="l01107"></a>01107 <span class="keyword">        </span>{
<a name="l01108"></a>01108           <span class="keywordflow">return</span> sqrt(<a class="code" href="a00014.html#9c8e2fedb9b5eea0a6808f5be43ebe2b" title="square of frobenius norm, need for block recursion">frobenius_norm2</a>());
<a name="l01109"></a>01109         }
<a name="l01110"></a>01110 
<a name="l01112"></a><a class="code" href="a00014.html#1eb40bca89f79deafe22cf7660631ee5">01112</a>     <span class="keywordtype">double</span> <a class="code" href="a00014.html#1eb40bca89f79deafe22cf7660631ee5" title="infinity norm (row sum norm, how to generalize for blocks?)">infinity_norm</a> ()<span class="keyword"> const</span>
<a name="l01113"></a>01113 <span class="keyword">        </span>{
<a name="l01114"></a>01114           <span class="keywordtype">double</span> max=0;
<a name="l01115"></a>01115           <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l01116"></a>01116           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l01117"></a>01117                 {
<a name="l01118"></a>01118                   <span class="keywordtype">double</span> sum=0;
<a name="l01119"></a>01119                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l01120"></a>01120                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l01121"></a>01121                         sum += (*j).infinity_norm();
<a name="l01122"></a>01122                   max = std::max(max,sum);
<a name="l01123"></a>01123                 }
<a name="l01124"></a>01124           <span class="keywordflow">return</span> max;
<a name="l01125"></a>01125         }
<a name="l01126"></a>01126 
<a name="l01128"></a><a class="code" href="a00014.html#3840b2c66eb7857a2215cbac1c89a939">01128</a>         <span class="keywordtype">double</span> <a class="code" href="a00014.html#3840b2c66eb7857a2215cbac1c89a939" title="simplified infinity norm (uses Manhattan norm for complex values)">infinity_norm_real</a> ()<span class="keyword"> const</span>
<a name="l01129"></a>01129 <span class="keyword">        </span>{
<a name="l01130"></a>01130           <span class="keywordtype">double</span> max=0;
<a name="l01131"></a>01131           <a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> endi=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>();
<a name="l01132"></a>01132           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> i=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); i!=endi; ++i)
<a name="l01133"></a>01133                 {
<a name="l01134"></a>01134                   <span class="keywordtype">double</span> sum=0;
<a name="l01135"></a>01135                   <a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> endj = (*i).end();
<a name="l01136"></a>01136                   <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> j=(*i).begin(); j!=endj; ++j)
<a name="l01137"></a>01137                         sum += (*j).infinity_norm_real();
<a name="l01138"></a>01138                   max = std::max(max,sum);
<a name="l01139"></a>01139                 }
<a name="l01140"></a>01140           <span class="keywordflow">return</span> max;
<a name="l01141"></a>01141         }
<a name="l01142"></a>01142 
<a name="l01143"></a>01143 
<a name="l01144"></a>01144         <span class="comment">//===== sizes</span>
<a name="l01145"></a>01145 
<a name="l01147"></a><a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3">01147</a>         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> <a class="code" href="a00014.html#cba88df8004f0727d3bf3e15823738d3" title="number of rows (counted in blocks)">N</a> ()<span class="keyword"> const</span>
<a name="l01148"></a>01148 <span class="keyword">        </span>{
<a name="l01149"></a>01149           <span class="keywordflow">return</span> n;
<a name="l01150"></a>01150         }
<a name="l01151"></a>01151 
<a name="l01153"></a><a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c">01153</a>         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> <a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a> ()<span class="keyword"> const</span>
<a name="l01154"></a>01154 <span class="keyword">        </span>{
<a name="l01155"></a>01155           <span class="keywordflow">return</span> m;
<a name="l01156"></a>01156         }
<a name="l01157"></a>01157 
<a name="l01159"></a><a class="code" href="a00014.html#3f5297ec1fa8bd41d9621b585506ca8a">01159</a>         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> <a class="code" href="a00014.html#3f5297ec1fa8bd41d9621b585506ca8a" title="number of blocks that are stored (the number of blocks that possibly are nonzero)...">nonzeroes</a> ()<span class="keyword"> const</span>
<a name="l01160"></a>01160 <span class="keyword">        </span>{
<a name="l01161"></a>01161           <span class="keywordflow">return</span> nnz;
<a name="l01162"></a>01162         }
<a name="l01163"></a>01163 
<a name="l01167"></a><a class="code" href="a00014.html#4b760ff7dea269606419c08327099b70">01167</a>         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> <a class="code" href="a00014.html#c99d028484d6bc089a53666e9b5a6a5a" title="dimension of the destination vector space">rowdim</a> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i)<span class="keyword"> const</span>
<a name="l01168"></a>01168 <span class="keyword">        </span>{
<a name="l01169"></a>01169           <span class="keyword">const</span> B* row = r[i].<a class="code" href="a00036.html#31d8e593c924c3714050d26b8cecfd5a" title="get pointer">getptr</a>();
<a name="l01170"></a>01170           <span class="keywordflow">if</span>(row)
<a name="l01171"></a>01171             <span class="keywordflow">return</span> row-&gt;rowdim();
<a name="l01172"></a>01172           <span class="keywordflow">else</span>
<a name="l01173"></a>01173             <span class="keywordflow">return</span> 0;
<a name="l01174"></a>01174         }
<a name="l01175"></a>01175 
<a name="l01179"></a><a class="code" href="a00014.html#6315a2601893ec58d3b1d86960304caf">01179</a>         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> <a class="code" href="a00014.html#385d26cb621202ec770777176541b428" title="dimension of the source vector space">coldim</a> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> c)<span class="keyword"> const</span>
<a name="l01180"></a>01180 <span class="keyword">        </span>{
<a name="l01181"></a>01181           <span class="comment">// find an entry in column j</span>
<a name="l01182"></a>01182           <span class="keywordflow">if</span> (nnz&gt;0)
<a name="l01183"></a>01183                 {
<a name="l01184"></a>01184                   <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> k=0; k&lt;nnz; k++) {
<a name="l01185"></a>01185                         <span class="keywordflow">if</span> (j[k]==c) {
<a name="l01186"></a>01186                           <span class="keywordflow">return</span> a[k].coldim();
<a name="l01187"></a>01187                         }
<a name="l01188"></a>01188                   }
<a name="l01189"></a>01189                 }
<a name="l01190"></a>01190           <span class="keywordflow">else</span>
<a name="l01191"></a>01191                 {
<a name="l01192"></a>01192                   <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i=0; i&lt;n; i++)
<a name="l01193"></a>01193                         {
<a name="l01194"></a>01194                           <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a>* j = r[i].<a class="code" href="a00036.html#fe4fc20a276763887fd925c90fd71688" title="get pointer">getindexptr</a>();
<a name="l01195"></a>01195                           B*   a = r[i].<a class="code" href="a00036.html#31d8e593c924c3714050d26b8cecfd5a" title="get pointer">getptr</a>();
<a name="l01196"></a>01196                           <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> k=0; k&lt;r[i].<a class="code" href="a00036.html#da993a1e41ffc1452a45e002b9c773a9" title="get size">getsize</a>(); k++)
<a name="l01197"></a>01197                                 <span class="keywordflow">if</span> (j[k]==c) {
<a name="l01198"></a>01198                                   <span class="keywordflow">return</span> a[k].coldim();
<a name="l01199"></a>01199                                 }
<a name="l01200"></a>01200                         }
<a name="l01201"></a>01201                 }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203           <span class="comment">// not found</span>
<a name="l01204"></a>01204           <span class="keywordflow">return</span> 0;
<a name="l01205"></a>01205         }
<a name="l01206"></a>01206 
<a name="l01208"></a><a class="code" href="a00014.html#c99d028484d6bc089a53666e9b5a6a5a">01208</a>         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> <a class="code" href="a00014.html#c99d028484d6bc089a53666e9b5a6a5a" title="dimension of the destination vector space">rowdim</a> ()<span class="keyword"> const</span>
<a name="l01209"></a>01209 <span class="keyword">        </span>{
<a name="l01210"></a>01210           <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> nn=0;
<a name="l01211"></a>01211           <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i=0; i&lt;n; i++)
<a name="l01212"></a>01212                 nn += <a class="code" href="a00014.html#c99d028484d6bc089a53666e9b5a6a5a" title="dimension of the destination vector space">rowdim</a>(i);
<a name="l01213"></a>01213           <span class="keywordflow">return</span> nn;
<a name="l01214"></a>01214         }
<a name="l01215"></a>01215 
<a name="l01217"></a><a class="code" href="a00014.html#385d26cb621202ec770777176541b428">01217</a>         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> <a class="code" href="a00014.html#385d26cb621202ec770777176541b428" title="dimension of the source vector space">coldim</a> ()<span class="keyword"> const</span>
<a name="l01218"></a>01218 <span class="keyword">        </span>{
<a name="l01219"></a>01219           <span class="comment">// The following code has a complexity of nnz, and</span>
<a name="l01220"></a>01220           <span class="comment">// typically a very small constant.</span>
<a name="l01221"></a>01221           <span class="comment">//</span>
<a name="l01222"></a>01222           std::vector&lt;size_type&gt; coldims(<a class="code" href="a00014.html#3c05e3862401b489dd1211844164196c" title="number of columns (counted in blocks)">M</a>(),-1);
<a name="l01223"></a>01223           <span class="keywordflow">for</span> (<a class="code" href="a00016.html" title="Iterator access to matrix rows">ConstRowIterator</a> row=<a class="code" href="a00014.html#0ad9c5258e0c65fde36f8793fdc96413" title="Get iterator to first row.">begin</a>(); row!=<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>(); ++row) 
<a name="l01224"></a>01224             <span class="keywordflow">for</span> (<a class="code" href="a00034.html" title="iterator class for sequential access">ConstColIterator</a> col=row-&gt;begin(); col!=row-&gt;end(); ++col)
<a name="l01225"></a>01225               <span class="comment">// only compute blocksizes we don't already have</span>
<a name="l01226"></a>01226               <span class="keywordflow">if</span> (coldims[col.index()]==-1) 
<a name="l01227"></a>01227                 coldims[col.index()] = col-&gt;coldim();
<a name="l01228"></a>01228 
<a name="l01229"></a>01229           <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> sum = 0;
<a name="l01230"></a>01230           <span class="keywordflow">for</span> (<span class="keyword">typename</span> std::vector&lt;size_type&gt;::iterator it=coldims.begin(); it!=coldims.end(); ++it)
<a name="l01231"></a>01231             <span class="comment">// skip rows for which no coldim could be determined</span>
<a name="l01232"></a>01232             <span class="keywordflow">if</span> ((*it)&gt;=0)
<a name="l01233"></a>01233               sum += *it;
<a name="l01234"></a>01234 
<a name="l01235"></a>01235           <span class="keywordflow">return</span> sum;
<a name="l01236"></a>01236         }
<a name="l01237"></a>01237 
<a name="l01238"></a>01238         <span class="comment">//===== query</span>
<a name="l01239"></a>01239         
<a name="l01241"></a><a class="code" href="a00014.html#be051bb73ea557651b2c1eb1b10b294d">01241</a>         <span class="keywordtype">bool</span> <a class="code" href="a00014.html#be051bb73ea557651b2c1eb1b10b294d" title="return true if (i,j) is in pattern">exists</a> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> j)<span class="keyword"> const</span>
<a name="l01242"></a>01242 <span class="keyword">        </span>{
<a name="l01243"></a>01243 <span class="preprocessor">#ifdef DUNE_ISTL_WITH_CHECKING</span>
<a name="l01244"></a>01244 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (i&lt;0 || i&gt;=n) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01245"></a>01245           <span class="keywordflow">if</span> (j&lt;0 || i&gt;=m) DUNE_THROW(<a class="code" href="a00067.html" title="derive error class from the base class in common">ISTLError</a>,<span class="stringliteral">"index out of range"</span>);
<a name="l01246"></a>01246 <span class="preprocessor">#endif</span>
<a name="l01247"></a>01247 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (r[i].size() &amp;&amp; r[i].find(j)!=r[i].<a class="code" href="a00014.html#801d09e6e79eba0e588d633e6d9d5049" title="Get iterator to one beyond last row.">end</a>()) 
<a name="l01248"></a>01248                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01249"></a>01249           <span class="keywordflow">else</span>
<a name="l01250"></a>01250                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01251"></a>01251         }
<a name="l01252"></a>01252 
<a name="l01253"></a>01253         
<a name="l01254"></a>01254   <span class="keyword">private</span>:
<a name="l01255"></a>01255         <span class="comment">// state information</span>
<a name="l01256"></a>01256         <a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ec" title="we support two modes">BuildMode</a> build_mode; <span class="comment">// row wise or whole matrix</span>
<a name="l01257"></a>01257         BuildStage ready;           <span class="comment">// indicate the stage the matrix building is in</span>
<a name="l01258"></a>01258 
<a name="l01259"></a>01259         <span class="comment">// size of the matrix</span>
<a name="l01260"></a>01260         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a>  n;  <span class="comment">// number of rows</span>
<a name="l01261"></a>01261         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a>  m;  <span class="comment">// number of columns</span>
<a name="l01262"></a>01262         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> nnz; <span class="comment">// number of nonzeros allocated in the a and j array below</span>
<a name="l01263"></a>01263              <span class="comment">// zero means that memory is allocated separately for each row.</span>
<a name="l01264"></a>01264 
<a name="l01265"></a>01265         <span class="comment">// the rows are dynamically allocated</span>
<a name="l01266"></a>01266         <a class="code" href="a00014.html#ab135eaab39502cd94ca8edb272c5ab3" title="implement row_type with compressed vector">row_type</a>* r; <span class="comment">// [n] the individual rows having pointers into a,j arrays</span>
<a name="l01267"></a>01267 
<a name="l01268"></a>01268         <span class="comment">// dynamically allocated memory</span>
<a name="l01269"></a>01269         B*   a;  <span class="comment">// [nnz] non-zero entries of the matrix in row-wise ordering</span>
<a name="l01270"></a>01270         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a>* j;  <span class="comment">// [nnz] column indices of entries</span>
<a name="l01271"></a>01271 
<a name="l01272"></a>01272     <span class="keywordtype">void</span> setWindowPointers(<a class="code" href="a00014.html#55aab1eeee5f07e1a1a19318cf196c7c" title="rename the const row iterator for easier access">ConstRowIterator</a> row)
<a name="l01273"></a>01273     {
<a name="l01274"></a>01274       <a class="code" href="a00014.html#ab135eaab39502cd94ca8edb272c5ab3" title="implement row_type with compressed vector">row_type</a> current_row(a,j,0); <span class="comment">// Pointers to current row data</span>
<a name="l01275"></a>01275       <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i=0; i&lt;n; i++, ++row){               
<a name="l01276"></a>01276         <span class="comment">// set row i</span>
<a name="l01277"></a>01277         <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> s = row-&gt;getsize();
<a name="l01278"></a>01278         
<a name="l01279"></a>01279         <span class="keywordflow">if</span> (s&gt;0){
<a name="l01280"></a>01280           <span class="comment">// setup pointers and size</span>
<a name="l01281"></a>01281           r[i].<a class="code" href="a00036.html#27ff91272583127e5ffe568afe04d066" title="set size and pointer">set</a>(s,current_row.getptr(), current_row.getindexptr());
<a name="l01282"></a>01282           <span class="comment">// update pointer for next row</span>
<a name="l01283"></a>01283           current_row.setptr(current_row.getptr()+s);
<a name="l01284"></a>01284           current_row.setindexptr(current_row.getindexptr()+s);
<a name="l01285"></a>01285         } <span class="keywordflow">else</span>{
<a name="l01286"></a>01286           <span class="comment">// empty row</span>
<a name="l01287"></a>01287           r[i].<a class="code" href="a00036.html#27ff91272583127e5ffe568afe04d066" title="set size and pointer">set</a>(0,0,0);
<a name="l01288"></a>01288         }
<a name="l01289"></a>01289       }
<a name="l01290"></a>01290     }
<a name="l01291"></a>01291     
<a name="l01293"></a>01293     <span class="keywordtype">void</span> copyWindowStructure(<span class="keyword">const</span> <a class="code" href="a00014.html#34b65fb52b4b7da95999604d8fabba92" title="an empty matrix">BCRSMatrix</a>&amp; Mat)
<a name="l01294"></a>01294     {
<a name="l01295"></a>01295       setWindowPointers(Mat.begin());
<a name="l01296"></a>01296             
<a name="l01297"></a>01297       <span class="comment">// copy data</span>
<a name="l01298"></a>01298       <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i=0; i&lt;n; i++) r[i] = Mat.r[i];
<a name="l01299"></a>01299 
<a name="l01300"></a>01300       <span class="comment">// finish off</span>
<a name="l01301"></a>01301       build_mode = <a class="code" href="a00014.html#6f09a4c408e14428d3a62ad00ceac9ecf7c450c73d8588d16cf4c65552b0ff18" title="Build in a row-wise manner.">row_wise</a>; <span class="comment">// dummy</span>
<a name="l01302"></a>01302       ready = built;
<a name="l01303"></a>01303     }
<a name="l01304"></a>01304   
<a name="l01310"></a>01310     <span class="keywordtype">void</span> deallocate(<span class="keywordtype">bool</span> deallocateRows=<span class="keyword">true</span>)
<a name="l01311"></a>01311     {
<a name="l01312"></a>01312       
<a name="l01313"></a>01313       <span class="keywordflow">if</span> (nnz&gt;0)
<a name="l01314"></a>01314         {
<a name="l01315"></a>01315           <span class="comment">// a,j have been allocated as one long vector</span>
<a name="l01316"></a>01316           A::template free&lt;size_type&gt;(j); 
<a name="l01317"></a>01317           A::template free&lt;B&gt;(a); 
<a name="l01318"></a>01318         }
<a name="l01319"></a>01319       <span class="keywordflow">else</span>
<a name="l01320"></a>01320         {
<a name="l01321"></a>01321           <span class="comment">// check if memory for rows have been allocated individually</span>
<a name="l01322"></a>01322           <span class="keywordflow">for</span> (<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> i=0; i&lt;n; i++)
<a name="l01323"></a>01323             <span class="keywordflow">if</span> (r[i].getsize()&gt;0) 
<a name="l01324"></a>01324               {
<a name="l01325"></a>01325                 A::template free&lt;size_type&gt;(r[i].<a class="code" href="a00036.html#fe4fc20a276763887fd925c90fd71688" title="get pointer">getindexptr</a>());
<a name="l01326"></a>01326                 A::template free&lt;B&gt;(r[i].<a class="code" href="a00036.html#31d8e593c924c3714050d26b8cecfd5a" title="get pointer">getptr</a>());
<a name="l01327"></a>01327               }
<a name="l01328"></a>01328         }
<a name="l01329"></a>01329       
<a name="l01330"></a>01330       <span class="comment">// deallocate the rows</span>
<a name="l01331"></a>01331       <span class="keywordflow">if</span> (n&gt;0 &amp;&amp; deallocateRows) A::template free&lt;row_type&gt;(r); 
<a name="l01332"></a>01332       
<a name="l01333"></a>01333       <span class="comment">// Mark matrix as not built at all.</span>
<a name="l01334"></a>01334       ready=notbuilt;
<a name="l01335"></a>01335       
<a name="l01336"></a>01336     }
<a name="l01337"></a>01337     
<a name="l01355"></a>01355     <span class="keywordtype">void</span> allocate(<a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> rows, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> columns, <a class="code" href="a00014.html#92dcd5f5afa082cf7c70ca745117108b" title="The type for the index access and the size.">size_type</a> nnz_=0, <span class="keywordtype">bool</span> allocateRows=<span class="keyword">true</span>)
<a name="l01356"></a>01356     {
<a name="l01357"></a>01357       <span class="comment">// Store size</span>
<a name="l01358"></a>01358       n = rows;
<a name="l01359"></a>01359       m = columns;
<a name="l01360"></a>01360       nnz = nnz_;
<a name="l01361"></a>01361 
<a name="l01362"></a>01362       <span class="comment">// allocate rows</span>
<a name="l01363"></a>01363       <span class="keywordflow">if</span>(allocateRows){
<a name="l01364"></a>01364         <span class="keywordflow">if</span> (n&gt;0){ 
<a name="l01365"></a>01365           r = A::template malloc&lt;row_type&gt;(rows);
<a name="l01366"></a>01366         }<span class="keywordflow">else</span>{
<a name="l01367"></a>01367           r = 0;
<a name="l01368"></a>01368         }
<a name="l01369"></a>01369       }
<a name="l01370"></a>01370       
<a name="l01371"></a>01371 
<a name="l01372"></a>01372       <span class="comment">// allocate a and j array</span>
<a name="l01373"></a>01373       <span class="keywordflow">if</span> (nnz&gt;0){ 
<a name="l01374"></a>01374         a = A::template malloc&lt;B&gt;(nnz);
<a name="l01375"></a>01375         j = A::template malloc&lt;size_type&gt;(nnz);
<a name="l01376"></a>01376       }<span class="keywordflow">else</span>{
<a name="l01377"></a>01377         a = 0;
<a name="l01378"></a>01378         j = 0;
<a name="l01379"></a>01379       }
<a name="l01380"></a>01380       <span class="comment">// Mark the matrix as not built.</span>
<a name="l01381"></a>01381       ready = notbuilt;
<a name="l01382"></a>01382     }
<a name="l01383"></a>01383     
<a name="l01384"></a>01384   };
<a name="l01385"></a>01385 
<a name="l01386"></a>01386 
<a name="l01387"></a>01387 <span class="preprocessor">#ifdef DUNE_EXPRESSIONTEMPLATES</span>
<a name="l01388"></a>01388 <span class="preprocessor"></span>  <span class="keyword">template</span> &lt;<span class="keyword">class</span> B, <span class="keyword">class</span> A&gt;
<a name="l01389"></a>01389   <span class="keyword">struct </span>FieldType&lt; BCRSMatrix&lt;B,A&gt; &gt;
<a name="l01390"></a>01390   {
<a name="l01391"></a>01391     <span class="keyword">typedef</span> <span class="keyword">typename</span> FieldType&lt;B&gt;::type type;
<a name="l01392"></a>01392   };
<a name="l01393"></a>01393   
<a name="l01394"></a>01394   <span class="keyword">template</span> &lt;<span class="keyword">class</span> B, <span class="keyword">class</span> A&gt;
<a name="l01395"></a>01395   <span class="keyword">struct </span>BlockType&lt; BCRSMatrix&lt;B,A&gt; &gt;
<a name="l01396"></a>01396   {
<a name="l01397"></a>01397     <span class="keyword">typedef</span> B type;
<a name="l01398"></a>01398   };
<a name="l01399"></a>01399   <span class="keyword">template</span> &lt;<span class="keyword">class</span> B, <span class="keyword">class</span> A&gt;
<a name="l01400"></a>01400   <span class="keyword">struct </span>RowType&lt; BCRSMatrix&lt;B,A&gt; &gt;
<a name="l01401"></a>01401   {
<a name="l01402"></a>01402     <span class="keyword">typedef</span> CompressedBlockVectorWindow&lt;B,A&gt; type;
<a name="l01403"></a>01403   };
<a name="l01404"></a>01404 <span class="preprocessor">#endif</span>
<a name="l01405"></a>01405 <span class="preprocessor"></span>
<a name="l01408"></a>01408 } <span class="comment">// end namespace</span>
<a name="l01409"></a>01409 
<a name="l01410"></a>01410 <span class="preprocessor">#endif</span>
</pre></div></div>
</div> <!-- end doxygen -->
</div> <!-- end main -->
<div class="foot">

<p class="foot">
  Generated on 6 Nov 2008 with <a
  href="http://www.doxygen.org/">Doxygen</a> (ver 1.5.6)  
  [<a href="doxygen.log">logfile</a>].
</p>

</div>

</body>
</html>
